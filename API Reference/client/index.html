
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      <link rel="icon" href="../../images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.3, mkdocs-material-7.3.6">
    
    
      
        <title>Client - Dis-Snek</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.a57b2b03.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.3f5d1f46.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../extra.css">
    
    
      

  


  

  


  <script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-9R5R4B0NDT"),document.addEventListener("DOMContentLoaded",function(){"undefined"!=typeof location$&&location$.subscribe(function(t){gtag("config","G-9R5R4B0NDT",{page_path:t.pathname})})})</script>
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-9R5R4B0NDT"></script>


    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="light-green" data-md-color-accent="lime">
  
    
    <script>function __prefix(e){return new URL("../..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
      <script>var palette=__get("__palette");if(null!==palette&&"object"==typeof palette.color)for(var key in palette.color)document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#dis_snek.client.Snake" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
        <aside class="md-banner md-announce">
          <div class="md-banner__inner md-announce__inner md-grid md-typeset">
            
  These docs are not completed. Please do not panic if something is missing or inaccurate

          </div>
        </aside>
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Dis-Snek" class="md-header__button md-logo" aria-label="Dis-Snek" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 22a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2h-6v7L9.5 7.5 7 9V2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Dis-Snek
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Client
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="light-green" data-md-color-accent="lime"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3 3.19.09m3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95 2.06.05m-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31z"/></svg>
            </label>
          
        
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="green" data-md-color-accent="lime"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5c-.84 0-1.65.15-2.39.42L12 2M3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29L3.34 7m.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14L3.36 17M20.65 7l-1.77 3.79a7.023 7.023 0 0 0-2.38-4.15l4.15.36m-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29L20.64 17M12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44L12 22z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08z"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        
<a href="https://github.com/LordOfPolls/dis_snek/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 480 512"><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg>
  </div>
  <div class="md-source__repository">
    LordOfPolls/dis_snek
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href="../.." class="md-tabs__link">
      Home
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../../FAQ/" class="md-tabs__link">
      FAQ
    </a>
  </li>

      
        
  
  
    
  


  
  
  
    <li class="md-tabs__item">
      <a href="./" class="md-tabs__link md-tabs__link--active">
        API Reference
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../Guides/1%20Getting%20Started/" class="md-tabs__link">
        Guides
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../snippets/discord_inv/" class="md-tabs__link">
        Snippets
      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Dis-Snek" class="md-nav__button md-logo" aria-label="Dis-Snek" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 22a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2h-6v7L9.5 7.5 7 9V2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12z"/></svg>

    </a>
    Dis-Snek
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/LordOfPolls/dis_snek/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 480 512"><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg>
  </div>
  <div class="md-source__repository">
    LordOfPolls/dis_snek
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../FAQ/" class="md-nav__link">
        FAQ
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          API Reference
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="API Reference" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          API Reference
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Client
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Client
      </a>
      
        


<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#dis_snek.client.Snake" class="md-nav__link">
    Snake
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../constants/" class="md-nav__link">
        Constants
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../enums/" class="md-nav__link">
        Enums
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../exceptions/" class="md-nav__link">
        Exceptions
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../gateway/" class="md-nav__link">
        Gateway
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../smart_cache/" class="md-nav__link">
        Smart cache
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_7" type="checkbox" id="__nav_3_7" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3_7">
          HTTP
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="HTTP" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_7">
          <span class="md-nav__icon md-icon"></span>
          HTTP
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../HTTP/HTTP_client/" class="md-nav__link">
        HTTP client
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../HTTP/Suported%20Endpoints/" class="md-nav__link">
        Suported Endpoints
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_8" type="checkbox" id="__nav_3_8" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3_8">
          Mixins
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Mixins" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_8">
          <span class="md-nav__icon md-icon"></span>
          Mixins
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../mixins/send/" class="md-nav__link">
        Send
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../mixins/serialization/" class="md-nav__link">
        Serialization
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_9" type="checkbox" id="__nav_3_9" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3_9">
          Models
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Models" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_9">
          <span class="md-nav__icon md-icon"></span>
          Models
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../models/Discord%20Models/" class="md-nav__link">
        Discord Models
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_9_2" type="checkbox" id="__nav_3_9_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3_9_2">
          Internal Models
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Internal Models" data-md-level="3">
        <label class="md-nav__title" for="__nav_3_9_2">
          <span class="md-nav__icon md-icon"></span>
          Internal Models
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../models/Internal%20Models/Context/" class="md-nav__link">
        Context
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../models/Internal%20Models/application%20commands/" class="md-nav__link">
        Application commands
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../models/Internal%20Models/checks/" class="md-nav__link">
        Checks
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../models/Internal%20Models/color/" class="md-nav__link">
        Color
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../models/Internal%20Models/command/" class="md-nav__link">
        Command
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../models/Internal%20Models/cooldowns/" class="md-nav__link">
        Cooldowns
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../models/Internal%20Models/discord/" class="md-nav__link">
        Discord
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../models/Internal%20Models/scale/" class="md-nav__link">
        Scale
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../models/Internal%20Models/snowflake/" class="md-nav__link">
        Snowflake
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../models/Internal%20Models/timestamp/" class="md-nav__link">
        Timestamp
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_9_3" type="checkbox" id="__nav_3_9_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3_9_3">
          Events
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Events" data-md-level="3">
        <label class="md-nav__title" for="__nav_3_9_3">
          <span class="md-nav__icon md-icon"></span>
          Events
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../models/events/discord/" class="md-nav__link">
        Discord
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../models/events/internal/" class="md-nav__link">
        Internal
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_10" type="checkbox" id="__nav_3_10" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3_10">
          Utils
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Utils" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_10">
          <span class="md-nav__icon md-icon"></span>
          Utils
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../utils/attr/" class="md-nav__link">
        Attr
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../utils/cache/" class="md-nav__link">
        Cache
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../utils/converters/" class="md-nav__link">
        Converters
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../utils/input_utils/" class="md-nav__link">
        Input utils
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../utils/misc/" class="md-nav__link">
        Misc
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../utils/serializer/" class="md-nav__link">
        Serializer
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4">
          Guides
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Guides" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Guides
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Guides/1%20Getting%20Started/" class="md-nav__link">
        Introduction
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Guides/Creating%20Your%20Bot/" class="md-nav__link">
        Creating Your Bot
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Guides/Migration%20From%20D.py/" class="md-nav__link">
        Migration From D.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Guides/example/" class="md-nav__link">
        Example
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Guides/scales/" class="md-nav__link">
        Scales
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      
      
      
        <label class="md-nav__link" for="__nav_5">
          Snippets
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Snippets" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Snippets
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../snippets/discord_inv/" class="md-nav__link">
        Discord inv
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../snippets/github_link/" class="md-nav__link">
        Github link
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#dis_snek.client.Snake" class="md-nav__link">
    Snake
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/LordOfPolls/dis_snek/edit/master/docs/API Reference/client.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                  <h1>Client</h1>
                
                <div class="doc doc-object doc-module">


    <div class="doc doc-contents first">




  <div class="doc doc-children">







  <div class="doc doc-object doc-class">



<h2 id="dis_snek.client.Snake" class="doc doc-heading">
        <code>
Snake            (<span title="dis_snek.event_processors.channel_events.ChannelEvents">ChannelEvents</span>, <span title="dis_snek.event_processors.guild_events.GuildEvents">GuildEvents</span>, <span title="dis_snek.event_processors.member_events.MemberEvents">MemberEvents</span>, <span title="dis_snek.event_processors.message_events.MessageEvents">MessageEvents</span>, <span title="dis_snek.event_processors.reaction_events.ReactionEvents">ReactionEvents</span>, <span title="dis_snek.event_processors.role_events.RoleEvents">RoleEvents</span>, <span title="dis_snek.event_processors.stage_events.StageEvents">StageEvents</span>, <span title="dis_snek.event_processors.thread_events.ThreadEvents">ThreadEvents</span>, <span title="dis_snek.event_processors.user_events.UserEvents">UserEvents</span>)
        </code>



<a href="#dis_snek.client.Snake" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">

      <p>The bot client.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>By default, all non-privileged intents will be enabled</p>
</div>

<p><strong>Attributes:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>intents</code></td>
        <td><code>Union[int, Intents]</code></td>
        <td><p>The intents to use</p></td>
      </tr>
      <tr>
        <td><code>loop</code></td>
        <td><code>asyncio.AbstractEventLoop</code></td>
        <td><p>An event loop to use, normally leave this blank</p></td>
      </tr>
      <tr>
        <td><code>default_prefix</code></td>
        <td><code>str</code></td>
        <td><p>The default_prefix to use for message commands, defaults to your bot being mentioned</p></td>
      </tr>
      <tr>
        <td><code>get_prefix</code></td>
        <td><code>Callable[..., Coroutine]</code></td>
        <td><p>A coroutine that returns a string to determine prefixes</p></td>
      </tr>
      <tr>
        <td><code>sync_interactions</code></td>
        <td><code>bool</code></td>
        <td><p>Should application commands be synced with discord?</p></td>
      </tr>
      <tr>
        <td><code>delete_unused_application_cmds</code></td>
        <td><code>bool</code></td>
        <td><p>Delete any commands from discord that arent implemented in this client</p></td>
      </tr>
      <tr>
        <td><code>asyncio_debug</code></td>
        <td><code>bool</code></td>
        <td><p>Enable asyncio debug features</p></td>
      </tr>
      <tr>
        <td><code>status</code></td>
        <td><code>Status</code></td>
        <td><p>The status the bot should login with (IE ONLINE, DND, IDLE)</p></td>
      </tr>
      <tr>
        <td><code>activity</code></td>
        <td><code>Activity</code></td>
        <td><p>The activity the bot should login "playing"</p></td>
      </tr>
  </tbody>
</table>      <p>Optionally, you can configure the caches here, by specifying the name of the cache, followed by a dict-style object to use.
It is recommended to use <code>smart_cache.create_cache</code> to configure the cache here.
as an example, this is a recommended attribute <code>message_cache=create_cache(250, 50)</code>,</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Setting a message cache hard limit to None is not recommended, as it could result in extremely high memory usage, we suggest a sane limit.</p>
</div>

        <details class="quote">
          <summary>Source code in <code>dis_snek/client.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">Snake</span><span class="p">(</span>
    <span class="n">ChannelEvents</span><span class="p">,</span>
    <span class="n">GuildEvents</span><span class="p">,</span>
    <span class="n">MemberEvents</span><span class="p">,</span>
    <span class="n">MessageEvents</span><span class="p">,</span>
    <span class="n">ReactionEvents</span><span class="p">,</span>
    <span class="n">RoleEvents</span><span class="p">,</span>
    <span class="n">StageEvents</span><span class="p">,</span>
    <span class="n">ThreadEvents</span><span class="p">,</span>
    <span class="n">UserEvents</span><span class="p">,</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The bot client.</span>

<span class="sd">    note:</span>
<span class="sd">        By default, all non-privileged intents will be enabled</span>

<span class="sd">    Attributes:</span>
<span class="sd">        intents Union[int, Intents]: The intents to use</span>
<span class="sd">        loop: An event loop to use, normally leave this blank</span>
<span class="sd">        default_prefix str: The default_prefix to use for message commands, defaults to your bot being mentioned</span>
<span class="sd">        get_prefix Callable[..., Coroutine]: A coroutine that returns a string to determine prefixes</span>
<span class="sd">        sync_interactions bool: Should application commands be synced with discord?</span>
<span class="sd">        delete_unused_application_cmds bool: Delete any commands from discord that arent implemented in this client</span>
<span class="sd">        asyncio_debug bool: Enable asyncio debug features</span>
<span class="sd">        status Status: The status the bot should login with (IE ONLINE, DND, IDLE)</span>
<span class="sd">        activity Activity: The activity the bot should login &quot;playing&quot;</span>

<span class="sd">    Optionally, you can configure the caches here, by specifying the name of the cache, followed by a dict-style object to use.</span>
<span class="sd">    It is recommended to use `smart_cache.create_cache` to configure the cache here.</span>
<span class="sd">    as an example, this is a recommended attribute `message_cache=create_cache(250, 50)`,</span>

<span class="sd">    !!! note</span>
<span class="sd">        Setting a message cache hard limit to None is not recommended, as it could result in extremely high memory usage, we suggest a sane limit.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">intents</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Intents</span><span class="p">]</span> <span class="o">=</span> <span class="n">Intents</span><span class="o">.</span><span class="n">DEFAULT</span><span class="p">,</span>
        <span class="n">loop</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">asyncio</span><span class="o">.</span><span class="n">AbstractEventLoop</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">default_prefix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">MENTION_PREFIX</span><span class="p">,</span>
        <span class="n">get_prefix</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">Coroutine</span><span class="p">]</span> <span class="o">=</span> <span class="n">MISSING</span><span class="p">,</span>
        <span class="n">sync_interactions</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">delete_unused_application_cmds</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">debug_scope</span><span class="p">:</span> <span class="s2">&quot;Snowflake_Type&quot;</span> <span class="o">=</span> <span class="n">MISSING</span><span class="p">,</span>
        <span class="n">asyncio_debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">status</span><span class="p">:</span> <span class="n">Status</span> <span class="o">=</span> <span class="n">Status</span><span class="o">.</span><span class="n">ONLINE</span><span class="p">,</span>
        <span class="n">activity</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Activity</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="p">:</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">AbstractEventLoop</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">get_event_loop</span><span class="p">()</span> <span class="k">if</span> <span class="n">loop</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">loop</span>

        <span class="c1"># Configuration</span>

        <span class="k">if</span> <span class="n">asyncio_debug</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Asyncio Debug is enabled, Your log will contain additional errors and warnings&quot;</span><span class="p">)</span>
            <span class="kn">import</span> <span class="nn">tracemalloc</span>

            <span class="n">tracemalloc</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">set_debug</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">intents</span> <span class="o">=</span> <span class="n">intents</span>
        <span class="sd">&quot;&quot;&quot;The intents in use&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sync_interactions</span> <span class="o">=</span> <span class="n">sync_interactions</span>
        <span class="sd">&quot;&quot;&quot;Should application commands be synced&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">del_unused_app_cmd</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">delete_unused_application_cmds</span>
        <span class="sd">&quot;&quot;&quot;Should unused application commands be deleted?&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debug_scope</span> <span class="o">=</span> <span class="n">to_optional_snowflake</span><span class="p">(</span><span class="n">debug_scope</span><span class="p">)</span>
        <span class="sd">&quot;&quot;&quot;Sync global commands as guild for quicker command updates during debug&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">default_prefix</span> <span class="o">=</span> <span class="n">default_prefix</span>
        <span class="sd">&quot;&quot;&quot;The default prefix to be used for message commands&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_prefix</span> <span class="o">=</span> <span class="n">get_prefix</span> <span class="k">if</span> <span class="n">get_prefix</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">MISSING</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_prefix</span>
        <span class="sd">&quot;&quot;&quot;A coroutine that returns a prefix, for dynamic prefixes&quot;&quot;&quot;</span>

        <span class="c1"># resources</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">http</span><span class="p">:</span> <span class="n">HTTPClient</span> <span class="o">=</span> <span class="n">HTTPClient</span><span class="p">(</span><span class="n">loop</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="p">)</span>
        <span class="sd">&quot;&quot;&quot;The HTTP client to use when interacting with discord endpoints&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ws</span><span class="p">:</span> <span class="n">WebsocketClient</span> <span class="o">=</span> <span class="n">MISSING</span>
        <span class="sd">&quot;&quot;&quot;The websocket collection for the Discord Gateway.&quot;&quot;&quot;</span>

        <span class="c1"># flags</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ready</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_closed</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_guild_event</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Event</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">guild_event_timeout</span> <span class="o">=</span> <span class="mi">3</span>
        <span class="sd">&quot;&quot;&quot;How long to wait for guilds to be cached&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_time</span> <span class="o">=</span> <span class="n">MISSING</span>
        <span class="sd">&quot;&quot;&quot;The DateTime the bot started at&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_mention_reg</span> <span class="o">=</span> <span class="n">MISSING</span>

        <span class="c1"># caches</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="p">:</span> <span class="n">GlobalCache</span> <span class="o">=</span> <span class="n">GlobalCache</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">GlobalCache</span><span class="p">,</span> <span class="n">k</span><span class="p">)})</span>
        <span class="c1"># these store the last sent presence data for change_presence</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_status</span><span class="p">:</span> <span class="n">Status</span> <span class="o">=</span> <span class="n">status</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">activity</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_activity</span> <span class="o">=</span> <span class="n">Activity</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">activity</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_activity</span><span class="p">:</span> <span class="n">Activity</span> <span class="o">=</span> <span class="n">activity</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_user</span><span class="p">:</span> <span class="n">SnakeBotUser</span> <span class="o">=</span> <span class="n">MISSING</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_app</span><span class="p">:</span> <span class="n">Application</span> <span class="o">=</span> <span class="n">MISSING</span>

        <span class="c1"># collections</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">commands</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">MessageCommand</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="sd">&quot;&quot;&quot;A dictionary of registered commands: `{name: command}`&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interactions</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="s2">&quot;Snowflake_Type&quot;</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">InteractionCommand</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="sd">&quot;&quot;&quot;A dictionary of registered application commands: `{cmd_id: command}`&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_component_callbacks</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">Coroutine</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_interaction_scopes</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="s2">&quot;Snowflake_Type&quot;</span><span class="p">,</span> <span class="s2">&quot;Snowflake_Type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__extensions</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scales</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="sd">&quot;&quot;&quot;A dictionary of mounted Scales&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">listeners</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">waits</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">is_closed</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Is the bot closed?&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_closed</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">is_ready</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ready</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">latency</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Returns the latency of the websocket connection&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ws</span><span class="o">.</span><span class="n">latency</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">user</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SnakeBotUser</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Returns the bot&#39;s user&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_user</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">app</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Application</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Returns the bots application&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_app</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">owner</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="s2">&quot;User&quot;</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Returns the bot&#39;s owner&#39;&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">owner</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">MISSING</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">guilds</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="s2">&quot;Guild&quot;</span><span class="p">]:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">guilds</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">status</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Status</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Get the status of the bot. IE online, afk, dnd&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_status</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">activity</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Activity</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Get the activity of the bot&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_activity</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">application_commands</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;a list of all application commands registered within the bot&quot;&quot;&quot;</span>
        <span class="n">commands</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">scope</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">interactions</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">cmd</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">interactions</span><span class="p">[</span><span class="n">scope</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">cmd</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">commands</span><span class="p">:</span>
                    <span class="n">commands</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">commands</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">get_prefix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="n">Message</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;A method to get the bot&#39;s default_prefix, can be overridden to add dynamic prefixes.</span>

<span class="sd">        !!! note</span>
<span class="sd">            To easily override this method, simply use the `get_prefix` parameter when instantiating the client</span>

<span class="sd">        Args:</span>
<span class="sd">            message: A message to determine the prefix from.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A string to use as a prefix, by default will return `client.default_prefix`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_prefix</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">login</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">token</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Login to discord</span>

<span class="sd">        Args:</span>
<span class="sd">            token str: Your bot&#39;s token</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># i needed somewhere to put this call,</span>
        <span class="c1"># login will always run after initialisation</span>
        <span class="c1"># so im gathering commands here</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_gather_commands</span><span class="p">()</span>

        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Attempting to login&quot;</span><span class="p">)</span>
        <span class="n">me</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">http</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_user</span> <span class="o">=</span> <span class="n">SnakeBotUser</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">me</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">place_user_data</span><span class="p">(</span><span class="n">me</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_app</span> <span class="o">=</span> <span class="n">Application</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">http</span><span class="o">.</span><span class="n">get_current_bot_information</span><span class="p">(),</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mention_reg</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">fr</span><span class="s2">&quot;^(&lt;@!?</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">*&gt;\s)&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dispatch</span><span class="p">(</span><span class="n">events</span><span class="o">.</span><span class="n">Login</span><span class="p">())</span>
        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ws_connect</span><span class="p">()</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">_ws_connect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;http&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">http</span><span class="p">,</span>
            <span class="s2">&quot;dispatch&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">dispatch</span><span class="p">,</span>
            <span class="s2">&quot;intents&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">intents</span><span class="p">,</span>
            <span class="s2">&quot;resume&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s2">&quot;session_id&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s2">&quot;sequence&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s2">&quot;presence&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_status</span><span class="p">,</span> <span class="s2">&quot;activities&quot;</span><span class="p">:</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_activity</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()]</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_activity</span> <span class="k">else</span> <span class="p">[]},</span>
        <span class="p">}</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_closed</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Attempting to </span><span class="si">{</span><span class="s1">&#39;re&#39;</span> <span class="k">if</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;resume&#39;</span><span class="p">]</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span><span class="si">}</span><span class="s2">connect to gateway...&quot;</span><span class="p">)</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ws</span> <span class="o">=</span> <span class="k">await</span> <span class="n">WebsocketClient</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="o">**</span><span class="n">params</span><span class="p">)</span>

                <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">ws</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
            <span class="k">except</span> <span class="n">WebSocketRestart</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
                <span class="c1"># internally requested restart</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dispatch</span><span class="p">(</span><span class="n">events</span><span class="o">.</span><span class="n">Disconnect</span><span class="p">())</span>
                <span class="k">if</span> <span class="n">ex</span><span class="o">.</span><span class="n">resume</span><span class="p">:</span>
                    <span class="n">params</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">resume</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">session_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ws</span><span class="o">.</span><span class="n">session_id</span><span class="p">,</span> <span class="n">sequence</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ws</span><span class="o">.</span><span class="n">sequence</span><span class="p">)</span>
                    <span class="k">continue</span>
                <span class="n">params</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">resume</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">session_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sequence</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

            <span class="k">except</span> <span class="p">(</span><span class="ne">OSError</span><span class="p">,</span> <span class="n">GatewayNotFound</span><span class="p">,</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientError</span><span class="p">,</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">TimeoutError</span><span class="p">,</span> <span class="n">WebSocketClosed</span><span class="p">)</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exception</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">ex</span><span class="p">),</span> <span class="n">ex</span><span class="p">,</span> <span class="n">ex</span><span class="o">.</span><span class="n">__traceback__</span><span class="p">)))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dispatch</span><span class="p">(</span><span class="n">events</span><span class="o">.</span><span class="n">Disconnect</span><span class="p">())</span>

                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ex</span><span class="p">,</span> <span class="n">WebSocketClosed</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">ex</span><span class="o">.</span><span class="n">code</span> <span class="o">==</span> <span class="mi">1000</span><span class="p">:</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ready</span><span class="p">:</span>
                            <span class="c1"># the bot disconnected, attempt to reconnect to gateway</span>
                            <span class="n">params</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">resume</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">session_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ws</span><span class="o">.</span><span class="n">session_id</span><span class="p">,</span> <span class="n">sequence</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ws</span><span class="o">.</span><span class="n">sequence</span><span class="p">)</span>
                            <span class="k">continue</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">return</span>
                    <span class="k">elif</span> <span class="n">ex</span><span class="o">.</span><span class="n">code</span> <span class="o">==</span> <span class="mi">4011</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="n">SnakeException</span><span class="p">(</span><span class="s2">&quot;Your bot is too large, you must use shards&quot;</span><span class="p">)</span> <span class="kn">from</span> <span class="bp">None</span>
                    <span class="k">elif</span> <span class="n">ex</span><span class="o">.</span><span class="n">code</span> <span class="o">==</span> <span class="mi">4013</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="n">SnakeException</span><span class="p">(</span><span class="s2">&quot;Invalid Intents have been passed&quot;</span><span class="p">)</span> <span class="kn">from</span> <span class="bp">None</span>
                    <span class="k">elif</span> <span class="n">ex</span><span class="o">.</span><span class="n">code</span> <span class="o">==</span> <span class="mi">4014</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="n">SnakeException</span><span class="p">(</span>
                            <span class="s2">&quot;You have requested privileged intents that have not been enabled or approved. Check the developer dashboard&quot;</span>
                        <span class="p">)</span> <span class="kn">from</span> <span class="bp">None</span>
                    <span class="k">raise</span>

                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ex</span><span class="p">,</span> <span class="ne">OSError</span><span class="p">)</span> <span class="ow">and</span> <span class="n">ex</span><span class="o">.</span><span class="n">errno</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">54</span><span class="p">,</span> <span class="mi">10054</span><span class="p">):</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;should reconnect&quot;</span><span class="p">)</span>
                    <span class="n">params</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">resume</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">session_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ws</span><span class="o">.</span><span class="n">session_id</span><span class="p">,</span> <span class="n">sequence</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ws</span><span class="o">.</span><span class="n">sequence</span><span class="p">)</span>
                    <span class="k">continue</span>
                <span class="n">params</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">resume</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">session_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sequence</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dispatch</span><span class="p">(</span><span class="n">events</span><span class="o">.</span><span class="n">Disconnect</span><span class="p">())</span>
                <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exception</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">e</span><span class="p">),</span> <span class="n">e</span><span class="p">,</span> <span class="n">e</span><span class="o">.</span><span class="n">__traceback__</span><span class="p">)))</span>
                <span class="n">params</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">resume</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">session_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sequence</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

            <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_queue_task</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coro</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">async</span> <span class="k">def</span> <span class="nf">_async_wrap</span><span class="p">(</span><span class="n">_coro</span><span class="p">,</span> <span class="n">_event</span><span class="p">,</span> <span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kwargs</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">_event</span><span class="o">.</span><span class="n">__attrs_attrs__</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="k">await</span> <span class="n">_coro</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">await</span> <span class="n">_coro</span><span class="p">(</span><span class="n">_event</span><span class="p">,</span> <span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kwargs</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">CancelledError</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_error</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>

        <span class="n">wrapped</span> <span class="o">=</span> <span class="n">_async_wrap</span><span class="p">(</span><span class="n">coro</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">create_task</span><span class="p">(</span><span class="n">wrapped</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;snake:: </span><span class="si">{</span><span class="n">event</span><span class="o">.</span><span class="n">resolved_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">on_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">error</span><span class="p">:</span> <span class="ne">Exception</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Catches all errors dispatched by the library.</span>

<span class="sd">        By default it will format and print them to console</span>

<span class="sd">        Override this to change error handling behaviour</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Ignoring exception in </span><span class="si">{</span><span class="n">source</span><span class="si">}</span><span class="s2">:</span><span class="se">\n</span><span class="si">{</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">on_command_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">error</span><span class="p">:</span> <span class="ne">Exception</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Catches all errors dispatched by commands</span>

<span class="sd">        By default it will call `Snake.on_error`</span>

<span class="sd">        Override this to change error handling behavior</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_error</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">error</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">on_command</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ctx</span><span class="p">:</span> <span class="n">Context</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Called *after* any command is ran</span>

<span class="sd">        By default, it will simply log the command, override this to change that behaviour</span>
<span class="sd">        Args:</span>
<span class="sd">            ctx: The context of the command that was called</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">MessageContext</span><span class="p">):</span>
            <span class="n">symbol</span> <span class="o">=</span> <span class="s2">&quot;@&quot;</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">ComponentContext</span><span class="p">):</span>
            <span class="n">symbol</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">InteractionContext</span><span class="p">):</span>
            <span class="n">symbol</span> <span class="o">=</span> <span class="s2">&quot;/&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">symbol</span> <span class="o">=</span> <span class="s2">&quot;?&quot;</span>  <span class="c1"># likely custom context</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Command Called: </span><span class="si">{</span><span class="n">symbol</span><span class="si">}{</span><span class="n">ctx</span><span class="o">.</span><span class="n">invoked_name</span><span class="si">}</span><span class="s2"> with </span><span class="si">{</span><span class="n">ctx</span><span class="o">.</span><span class="n">args</span> <span class="si">= }</span><span class="s2"> | </span><span class="si">{</span><span class="n">ctx</span><span class="o">.</span><span class="n">kwargs</span> <span class="si">= }</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="nd">@listen</span><span class="p">()</span>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">_on_websocket_ready</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="n">events</span><span class="o">.</span><span class="n">RawGatewayEvent</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Catches websocket ready and determines when to dispatch the client `READY` signal.</span>

<span class="sd">        Args:</span>
<span class="sd">            event: The websocket ready packet</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">data</span>
        <span class="n">expected_guilds</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">to_snowflake</span><span class="p">(</span><span class="n">guild</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">])</span> <span class="k">for</span> <span class="n">guild</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;guilds&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_user</span><span class="o">.</span><span class="n">_add_guilds</span><span class="p">(</span><span class="n">expected_guilds</span><span class="p">)</span>

        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>  <span class="c1"># wait to let guilds cache</span>
                <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">wait_for</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_guild_event</span><span class="o">.</span><span class="n">wait</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">guild_event_timeout</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">TimeoutError</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Timeout waiting for guilds cache: Not all guilds will be in cache&quot;</span><span class="p">)</span>
                <span class="k">break</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_guild_event</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">guild_cache</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">expected_guilds</span><span class="p">):</span>
                <span class="c1"># all guilds cached</span>
                <span class="k">break</span>

        <span class="c1"># cache slash commands</span>
        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_init_interactions</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_ready</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dispatch</span><span class="p">(</span><span class="n">events</span><span class="o">.</span><span class="n">Ready</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">token</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Start the bot.</span>

<span class="sd">        info:</span>
<span class="sd">            This is the recommended method to start the bot</span>

<span class="sd">        Args:</span>
<span class="sd">            token str: Your bot&#39;s token</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">run_until_complete</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">token</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">run_until_complete</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="p">())</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Stopping the bot.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ready</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">ws</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="mi">1001</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">dispatch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="n">events</span><span class="o">.</span><span class="n">BaseEvent</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Dispatch an event.</span>

<span class="sd">        Args:</span>
<span class="sd">            event: The event to be dispatched.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Dispatching Event: </span><span class="si">{</span><span class="n">event</span><span class="o">.</span><span class="n">resolved_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">listeners</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">listeners</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">resolved_name</span><span class="p">,</span> <span class="p">[])</span>
        <span class="k">for</span> <span class="n">_listen</span> <span class="ow">in</span> <span class="n">listeners</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_queue_task</span><span class="p">(</span><span class="n">_listen</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">BotException</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;An error occurred attempting during </span><span class="si">{</span><span class="n">event</span><span class="o">.</span><span class="n">resolved_name</span><span class="si">}</span><span class="s2"> event processing&quot;</span><span class="p">)</span>

        <span class="n">_waits</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">waits</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">resolved_name</span><span class="p">,</span> <span class="p">[])</span>
        <span class="n">index_to_remove</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">_wait</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">_waits</span><span class="p">):</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">_wait</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">result</span><span class="p">:</span>
                <span class="n">index_to_remove</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">index_to_remove</span><span class="p">:</span>
            <span class="n">_waits</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">wait_for</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">checks</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]]</span> <span class="o">=</span> <span class="n">MISSING</span><span class="p">,</span> <span class="n">timeout</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Waits for a WebSocket event to be dispatched.</span>

<span class="sd">        Args:</span>
<span class="sd">            event: The name of event to wait.</span>
<span class="sd">            checks: A predicate to check what to wait for.</span>
<span class="sd">            timeout: The number of seconds to wait before timing out.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The event object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">event</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">waits</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">waits</span><span class="p">[</span><span class="n">event</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">future</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">create_future</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">waits</span><span class="p">[</span><span class="n">event</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Wait</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">checks</span><span class="p">,</span> <span class="n">future</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">wait_for</span><span class="p">(</span><span class="n">future</span><span class="p">,</span> <span class="n">timeout</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">wait_for_component</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">messages</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Message</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">list</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">components</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span>
            <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="s2">&quot;BaseComponent&quot;</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]]],</span> <span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="s2">&quot;BaseComponent&quot;</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]],</span> <span class="s2">&quot;BaseComponent&quot;</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]</span>
        <span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">check</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">timeout</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Awaitable</span><span class="p">[</span><span class="s2">&quot;Future&quot;</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Waits for a message to be sent to the bot.</span>

<span class="sd">        Args:</span>
<span class="sd">            messages: The message object to check for.</span>
<span class="sd">            components: The components to wait for.</span>
<span class="sd">            check: A predicate to check what to wait for.</span>
<span class="sd">            timeout: The number of seconds to wait before timing out.</span>

<span class="sd">        Returns:</span>
<span class="sd">            `Component` that was invoked, or `None` if timed out. Use `.context` to get the `ComponentContext`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">messages</span> <span class="ow">or</span> <span class="n">components</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;You must specify messages or components (or both)&quot;</span><span class="p">)</span>

        <span class="n">message_ids</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">to_snowflake_list</span><span class="p">(</span><span class="n">messages</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">messages</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="n">to_snowflake</span><span class="p">(</span><span class="n">messages</span><span class="p">)</span> <span class="k">if</span> <span class="n">messages</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="p">)</span>
        <span class="n">custom_ids</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">get_components_ids</span><span class="p">(</span><span class="n">components</span><span class="p">))</span> <span class="k">if</span> <span class="n">components</span> <span class="k">else</span> <span class="kc">None</span>

        <span class="c1"># automatically convert improper custom_ids</span>
        <span class="k">if</span> <span class="n">custom_ids</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">custom_ids</span><span class="p">):</span>
            <span class="n">custom_ids</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">custom_ids</span><span class="p">]</span>

        <span class="k">def</span> <span class="nf">_check</span><span class="p">(</span><span class="n">event</span><span class="p">:</span> <span class="n">Component</span><span class="p">):</span>
            <span class="n">ctx</span><span class="p">:</span> <span class="n">ComponentContext</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">context</span>
            <span class="c1"># if custom_ids is empty or there is a match</span>
            <span class="n">wanted_message</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">message_ids</span> <span class="ow">or</span> <span class="n">ctx</span><span class="o">.</span><span class="n">message</span><span class="o">.</span><span class="n">id</span> <span class="ow">in</span> <span class="p">(</span>
                <span class="p">[</span><span class="n">message_ids</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">message_ids</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="k">else</span> <span class="n">message_ids</span>
            <span class="p">)</span>
            <span class="n">wanted_component</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">custom_ids</span> <span class="ow">or</span> <span class="n">ctx</span><span class="o">.</span><span class="n">custom_id</span> <span class="ow">in</span> <span class="n">custom_ids</span>
            <span class="k">if</span> <span class="n">wanted_message</span> <span class="ow">and</span> <span class="n">wanted_component</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">check</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">check</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
                    <span class="k">return</span> <span class="kc">True</span>
                <span class="k">return</span> <span class="kc">False</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">wait_for</span><span class="p">(</span><span class="s2">&quot;component&quot;</span><span class="p">,</span> <span class="n">checks</span><span class="o">=</span><span class="n">_check</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">add_listener</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">listener</span><span class="p">:</span> <span class="n">Listener</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a listener for an event, if no event is passed, one is determined</span>

<span class="sd">        Args:</span>
<span class="sd">            coro Listener: The listener to add to the client</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">listener</span><span class="o">.</span><span class="n">event</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">listeners</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">listeners</span><span class="p">[</span><span class="n">listener</span><span class="o">.</span><span class="n">event</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">listeners</span><span class="p">[</span><span class="n">listener</span><span class="o">.</span><span class="n">event</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">listener</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">add_interaction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">:</span> <span class="n">InteractionCommand</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a slash command to the client.</span>

<span class="sd">        Args:</span>
<span class="sd">            command InteractionCommand: The command to add</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug_scope</span><span class="p">:</span>
            <span class="n">command</span><span class="o">.</span><span class="n">scopes</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">debug_scope</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">scope</span> <span class="ow">in</span> <span class="n">command</span><span class="o">.</span><span class="n">scopes</span><span class="p">:</span>

            <span class="k">if</span> <span class="n">scope</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">interactions</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">interactions</span><span class="p">[</span><span class="n">scope</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">elif</span> <span class="n">command</span><span class="o">.</span><span class="n">resolved_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">interactions</span><span class="p">[</span><span class="n">scope</span><span class="p">]:</span>
                <span class="n">old_cmd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">interactions</span><span class="p">[</span><span class="n">scope</span><span class="p">][</span><span class="n">command</span><span class="o">.</span><span class="n">resolved_name</span><span class="p">]</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Duplicate Command! </span><span class="si">{</span><span class="n">scope</span><span class="si">}</span><span class="s2">::</span><span class="si">{</span><span class="n">old_cmd</span><span class="o">.</span><span class="n">resolved_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">interactions</span><span class="p">[</span><span class="n">scope</span><span class="p">][</span><span class="n">command</span><span class="o">.</span><span class="n">resolved_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">command</span>

    <span class="k">def</span> <span class="nf">add_message_command</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">:</span> <span class="n">MessageCommand</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a message command to the client.</span>

<span class="sd">        Args:</span>
<span class="sd">            command InteractionCommand: The command to add</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">command</span><span class="o">.</span><span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">commands</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">commands</span><span class="p">[</span><span class="n">command</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">command</span>
            <span class="k">return</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Duplicate Command! Multiple commands share the name `</span><span class="si">{</span><span class="n">command</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">`&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">add_component_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">:</span> <span class="n">ComponentCommand</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add a component callback to the client</span>

<span class="sd">        Args:</span>
<span class="sd">            command: The command to add</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">listener</span> <span class="ow">in</span> <span class="n">command</span><span class="o">.</span><span class="n">listeners</span><span class="p">:</span>
            <span class="c1"># I know this isn&#39;t an ideal solution, but it means we can lookup callbacks with O(1)</span>
            <span class="k">if</span> <span class="n">listener</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_component_callbacks</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_component_callbacks</span><span class="p">[</span><span class="n">listener</span><span class="p">]</span> <span class="o">=</span> <span class="n">command</span>
                <span class="k">continue</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Duplicate Component! Multiple component callbacks for `</span><span class="si">{</span><span class="n">listener</span><span class="si">}</span><span class="s2">`&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_gather_commands</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Gathers commands from __main__ and self&quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">process</span><span class="p">(</span><span class="n">_cmds</span><span class="p">):</span>

            <span class="k">for</span> <span class="n">func</span> <span class="ow">in</span> <span class="n">_cmds</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">ComponentCommand</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">add_component_callback</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">InteractionCommand</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">add_interaction</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">MessageCommand</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">add_message_command</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">Listener</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">add_listener</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>

            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">_cmds</span><span class="p">)</span><span class="si">}</span><span class="s2"> commands have been loaded from `__main__` and `client`&quot;</span><span class="p">)</span>

        <span class="n">process</span><span class="p">(</span>
            <span class="p">[</span><span class="n">obj</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getmembers</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s2">&quot;__main__&quot;</span><span class="p">])</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="p">(</span><span class="n">BaseCommand</span><span class="p">,</span> <span class="n">Listener</span><span class="p">))]</span>
        <span class="p">)</span>
        <span class="n">process</span><span class="p">(</span>
            <span class="p">[</span><span class="n">wrap_partial</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getmembers</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="p">(</span><span class="n">BaseCommand</span><span class="p">,</span> <span class="n">Listener</span><span class="p">))]</span>
        <span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">_init_interactions</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialise slash commands.</span>

<span class="sd">        If `sync_interactions` this will submit all registered slash commands to discord.</span>
<span class="sd">        Otherwise, it will get the list of interactions and cache their scopes.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># allow for cogs and main to share the same decorator</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sync_interactions</span><span class="p">:</span>
                <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">synchronise_interactions</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cache_interactions</span><span class="p">(</span><span class="n">warn_missing</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_error</span><span class="p">(</span><span class="s2">&quot;Interaction Syncing&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">_cache_interactions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">warn_missing</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get all interactions used by this bot and cache them.&quot;&quot;&quot;</span>
        <span class="n">bot_scopes</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">id</span> <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">guild_cache</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
        <span class="n">bot_scopes</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">GLOBAL_SCOPE</span><span class="p">)</span>

        <span class="c1"># Match all interaction is registered with discord&#39;s data.</span>
        <span class="k">for</span> <span class="n">scope</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">interactions</span><span class="p">:</span>
            <span class="n">bot_scopes</span><span class="o">.</span><span class="n">discard</span><span class="p">(</span><span class="n">scope</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">remote_cmds</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">http</span><span class="o">.</span><span class="n">get_interaction_element</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">scope</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">Forbidden</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">InteractionMissingAccess</span><span class="p">(</span><span class="n">scope</span><span class="p">)</span> <span class="kn">from</span> <span class="bp">None</span>

            <span class="n">remote_cmds</span> <span class="o">=</span> <span class="p">{</span><span class="n">cmd_data</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]:</span> <span class="n">cmd_data</span> <span class="k">for</span> <span class="n">cmd_data</span> <span class="ow">in</span> <span class="n">remote_cmds</span><span class="p">}</span>
            <span class="n">found</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>  <span class="c1"># this is a temporary hack to fix subcommand detection</span>
            <span class="k">for</span> <span class="n">cmd</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">interactions</span><span class="p">[</span><span class="n">scope</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="n">cmd_data</span> <span class="o">=</span> <span class="n">remote_cmds</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">cmd</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">MISSING</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">cmd_data</span> <span class="ow">is</span> <span class="n">MISSING</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">cmd</span><span class="o">.</span><span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">found</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">warn_missing</span><span class="p">:</span>
                            <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                                <span class="sa">f</span><span class="s1">&#39;Detected yet to sync slash command &quot;/</span><span class="si">{</span><span class="n">cmd</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">&quot; for scope &#39;</span>
                                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;global&#39;</span> <span class="k">if</span> <span class="n">scope</span> <span class="o">==</span> <span class="n">GLOBAL_SCOPE</span> <span class="k">else</span> <span class="n">scope</span><span class="si">}</span><span class="s2">&quot;</span>
                            <span class="p">)</span>
                    <span class="k">continue</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">found</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">cmd</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">_interaction_scopes</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">cmd_data</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">])]</span> <span class="o">=</span> <span class="n">scope</span>
                <span class="n">cmd</span><span class="o">.</span><span class="n">cmd_id</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">cmd_data</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">])</span>

            <span class="k">if</span> <span class="n">warn_missing</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">cmd_data</span> <span class="ow">in</span> <span class="n">remote_cmds</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                    <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Detected unimplemented slash command </span><span class="se">\&quot;</span><span class="s2">/</span><span class="si">{</span><span class="n">cmd_data</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="se">\&quot;</span><span class="s2"> for scope &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;global&#39;</span> <span class="k">if</span> <span class="n">scope</span> <span class="o">==</span> <span class="n">GLOBAL_SCOPE</span> <span class="k">else</span> <span class="n">scope</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="p">)</span>

        <span class="c1"># Remaining guilds that bot is in but, no interaction is registered</span>
        <span class="k">for</span> <span class="n">scope</span> <span class="ow">in</span> <span class="n">bot_scopes</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">remote_cmds</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">http</span><span class="o">.</span><span class="n">get_interaction_element</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">scope</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">Forbidden</span><span class="p">:</span>
                <span class="c1"># We will just assume they don&#39;t want application commands in this guild.</span>
                <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Bot was not invited to guild </span><span class="si">{</span><span class="n">scope</span><span class="si">}</span><span class="s2"> with `application.commands` scope&quot;</span><span class="p">)</span>
                <span class="k">continue</span>

            <span class="k">for</span> <span class="n">cmd_data</span> <span class="ow">in</span> <span class="n">remote_cmds</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_interaction_scopes</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">cmd_data</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">])]</span> <span class="o">=</span> <span class="n">scope</span>
                <span class="k">if</span> <span class="n">warn_missing</span><span class="p">:</span>
                    <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Detected unimplemented slash command </span><span class="se">\&quot;</span><span class="s2">/</span><span class="si">{</span><span class="n">cmd_data</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="se">\&quot;</span><span class="s2"> for scope &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;global&#39;</span> <span class="k">if</span> <span class="n">scope</span> <span class="o">==</span> <span class="n">GLOBAL_SCOPE</span> <span class="k">else</span> <span class="n">scope</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">synchronise_interactions</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Synchronise registered interactions with discord</span>

<span class="sd">        One flaw of this is it cant determine if context menus need updating,</span>
<span class="sd">        as discord isn&#39;t returning that data on get req, so they are unnecessarily updated&quot;&quot;&quot;</span>

        <span class="c1"># first we need to make sure our local copy of cmd_ids is up-to-date</span>
        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cache_interactions</span><span class="p">()</span>
        <span class="n">cmd_scopes</span> <span class="o">=</span> <span class="p">[</span><span class="n">to_snowflake</span><span class="p">(</span><span class="n">g_id</span><span class="p">)</span> <span class="k">for</span> <span class="n">g_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_user</span><span class="o">.</span><span class="n">_guild_ids</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">GLOBAL_SCOPE</span><span class="p">]</span>

        <span class="n">guild_perms</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="n">cmds_json</span> <span class="o">=</span> <span class="n">application_commands_to_dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">interactions</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">cmd_scope</span> <span class="ow">in</span> <span class="n">cmd_scopes</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">cmds_resp_data</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">http</span><span class="o">.</span><span class="n">get_interaction_element</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">cmd_scope</span><span class="p">)</span>
                <span class="n">need_to_sync</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="n">cmds_to_sync</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">found</span> <span class="o">=</span> <span class="p">[]</span>

                <span class="k">for</span> <span class="n">local_cmd</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">interactions</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">cmd_scope</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                    <span class="c1"># try and find remote equiv of this command</span>
                    <span class="n">remote_cmd</span> <span class="o">=</span> <span class="nb">next</span><span class="p">((</span><span class="n">v</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">cmds_resp_data</span> <span class="k">if</span> <span class="n">v</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">local_cmd</span><span class="o">.</span><span class="n">cmd_id</span><span class="p">),</span> <span class="kc">None</span><span class="p">)</span>

                    <span class="n">local_cmd</span> <span class="o">=</span> <span class="nb">next</span><span class="p">((</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">cmds_json</span><span class="p">[</span><span class="n">cmd_scope</span><span class="p">]</span> <span class="k">if</span> <span class="n">c</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">local_cmd</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>

                    <span class="k">if</span> <span class="n">local_cmd</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">cmds_to_sync</span><span class="p">:</span>
                        <span class="n">cmds_to_sync</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">local_cmd</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">remote_cmd</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">found</span><span class="p">:</span>
                        <span class="n">found</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">remote_cmd</span><span class="p">)</span>

                    <span class="c1"># todo: prevent un-needed syncs for subcommands</span>
                    <span class="k">if</span> <span class="n">sync_needed</span><span class="p">(</span><span class="n">local_cmd</span><span class="p">,</span> <span class="n">remote_cmd</span><span class="p">):</span>
                        <span class="c1"># if command local data doesnt match remote, a change has been made, sync it</span>
                        <span class="n">need_to_sync</span> <span class="o">=</span> <span class="kc">True</span>

                <span class="k">if</span> <span class="n">need_to_sync</span><span class="p">:</span>
                    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Updating </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">cmds_to_sync</span><span class="p">)</span><span class="si">}</span><span class="s2"> commands in </span><span class="si">{</span><span class="n">cmd_scope</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">cmd_sync_resp</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">http</span><span class="o">.</span><span class="n">post_interaction_element</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">cmds_to_sync</span><span class="p">,</span> <span class="n">guild_id</span><span class="o">=</span><span class="n">cmd_scope</span>
                    <span class="p">)</span>
                    <span class="c1"># cache cmd_ids and their scopes</span>
                    <span class="k">for</span> <span class="n">cmd_data</span> <span class="ow">in</span> <span class="n">cmd_sync_resp</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_interaction_scopes</span><span class="p">[</span><span class="n">cmd_data</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">cmd_scope</span>
                        <span class="k">if</span> <span class="n">cmd_data</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">interactions</span><span class="p">[</span><span class="n">cmd_scope</span><span class="p">]:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">interactions</span><span class="p">[</span><span class="n">cmd_scope</span><span class="p">][</span><span class="n">cmd_data</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">cmd_id</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">cmd_data</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">])</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="c1"># sub_cmd</span>
                            <span class="k">for</span> <span class="n">sc</span> <span class="ow">in</span> <span class="n">cmd_data</span><span class="p">[</span><span class="s2">&quot;options&quot;</span><span class="p">]:</span>
                                <span class="k">if</span> <span class="n">sc</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">OptionTypes</span><span class="o">.</span><span class="n">SUB_COMMAND</span><span class="p">:</span>
                                    <span class="k">if</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">cmd_data</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">sc</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">interactions</span><span class="p">[</span><span class="n">cmd_scope</span><span class="p">]:</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">interactions</span><span class="p">[</span><span class="n">cmd_scope</span><span class="p">][</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">cmd_data</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">sc</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">cmd_id</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
                                            <span class="n">cmd_data</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span>
                                        <span class="p">)</span>
                                <span class="k">elif</span> <span class="n">sc</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">OptionTypes</span><span class="o">.</span><span class="n">SUB_COMMAND_GROUP</span><span class="p">:</span>
                                    <span class="k">for</span> <span class="n">_sc</span> <span class="ow">in</span> <span class="n">sc</span><span class="p">[</span><span class="s2">&quot;options&quot;</span><span class="p">]:</span>
                                        <span class="k">if</span> <span class="p">(</span>
                                            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">cmd_data</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">sc</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">_sc</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
                                            <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">interactions</span><span class="p">[</span><span class="n">cmd_scope</span><span class="p">]</span>
                                        <span class="p">):</span>
                                            <span class="bp">self</span><span class="o">.</span><span class="n">interactions</span><span class="p">[</span><span class="n">cmd_scope</span><span class="p">][</span>
                                                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">cmd_data</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">sc</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">_sc</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
                                            <span class="p">]</span><span class="o">.</span><span class="n">cmd_id</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">cmd_data</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">])</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">cmd_scope</span><span class="si">}</span><span class="s2"> is already up-to-date with </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">cmds_resp_data</span><span class="p">)</span><span class="si">}</span><span class="s2"> commands.&quot;</span><span class="p">)</span>

                <span class="k">for</span> <span class="n">local_cmd</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">interactions</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">cmd_scope</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">local_cmd</span><span class="o">.</span><span class="n">permissions</span><span class="p">:</span>
                        <span class="k">continue</span>

                    <span class="k">for</span> <span class="n">perm_scope</span><span class="p">,</span> <span class="n">perms</span> <span class="ow">in</span> <span class="n">local_cmd</span><span class="o">.</span><span class="n">permissions</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                        <span class="k">if</span> <span class="n">perm_scope</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">guild_perms</span><span class="p">:</span>
                            <span class="n">guild_perms</span><span class="p">[</span><span class="n">perm_scope</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                        <span class="n">guild_perms</span><span class="p">[</span><span class="n">perm_scope</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                            <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">local_cmd</span><span class="o">.</span><span class="n">cmd_id</span><span class="p">,</span> <span class="s2">&quot;permissions&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">perm</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span> <span class="k">for</span> <span class="n">perm</span> <span class="ow">in</span> <span class="n">perms</span><span class="p">]}</span>
                        <span class="p">)</span>

                <span class="k">for</span> <span class="n">perm_scope</span> <span class="ow">in</span> <span class="n">guild_perms</span><span class="p">:</span>
                    <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Updating </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">guild_perms</span><span class="p">[</span><span class="n">perm_scope</span><span class="p">])</span><span class="si">}</span><span class="s2"> command permissions in </span><span class="si">{</span><span class="n">perm_scope</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">http</span><span class="o">.</span><span class="n">batch_edit_application_command_permissions</span><span class="p">(</span>
                        <span class="n">application_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">scope</span><span class="o">=</span><span class="n">perm_scope</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">guild_perms</span><span class="p">[</span><span class="n">perm_scope</span><span class="p">]</span>
                    <span class="p">)</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">del_unused_app_cmd</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">cmd</span> <span class="ow">in</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">cmds_resp_data</span> <span class="k">if</span> <span class="n">c</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">found</span><span class="p">]:</span>
                        <span class="n">scope</span> <span class="o">=</span> <span class="n">cmd</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;guild_id&quot;</span><span class="p">,</span> <span class="n">GLOBAL_SCOPE</span><span class="p">)</span>
                        <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;Deleting unimplemented slash command </span><span class="se">\&quot;</span><span class="s2">/</span><span class="si">{</span><span class="n">cmd</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="se">\&quot;</span><span class="s2"> from scope &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;global&#39;</span> <span class="k">if</span> <span class="n">scope</span> <span class="o">==</span> <span class="n">GLOBAL_SCOPE</span> <span class="k">else</span> <span class="n">scope</span><span class="si">}</span><span class="s2">&quot;</span>
                        <span class="p">)</span>
                        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">http</span><span class="o">.</span><span class="n">delete_interaction_element</span><span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">cmd</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;guild_id&quot;</span><span class="p">,</span> <span class="n">GLOBAL_SCOPE</span><span class="p">),</span> <span class="n">cmd</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span>
                        <span class="p">)</span>
            <span class="k">except</span> <span class="n">Forbidden</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">InteractionMissingAccess</span><span class="p">(</span><span class="n">cmd_scope</span><span class="p">)</span> <span class="kn">from</span> <span class="bp">None</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">get_context</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">dict</span><span class="p">,</span> <span class="n">Message</span><span class="p">],</span> <span class="n">interaction</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">MessageContext</span><span class="p">,</span> <span class="n">InteractionContext</span><span class="p">,</span> <span class="n">ComponentContext</span><span class="p">,</span> <span class="n">AutocompleteContext</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a context object based on data passed</span>

<span class="sd">        note:</span>
<span class="sd">            If you want to use custom context objects, this is the method to override. Your replacement must take the same arguments as this, and return a Context-like object.</span>

<span class="sd">        Args:</span>
<span class="sd">            data: The data of the event</span>
<span class="sd">            interaction: Is this an interaction or not?</span>

<span class="sd">        returns:</span>
<span class="sd">            Context object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># this line shuts up IDE warnings</span>
        <span class="bp">cls</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">MessageContext</span><span class="p">,</span> <span class="n">ComponentContext</span><span class="p">,</span> <span class="n">InteractionContext</span><span class="p">,</span> <span class="n">AutocompleteContext</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">interaction</span><span class="p">:</span>
            <span class="c1"># todo: change to match</span>
            <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">InteractionTypes</span><span class="o">.</span><span class="n">MESSAGE_COMPONENT</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">ComponentContext</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">InteractionTypes</span><span class="o">.</span><span class="n">AUTOCOMPLETE</span><span class="p">:</span>
                <span class="bp">cls</span> <span class="o">=</span> <span class="n">AutocompleteContext</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">cls</span> <span class="o">=</span> <span class="n">InteractionContext</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

            <span class="n">invoked_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
            <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{}</span>

            <span class="k">if</span> <span class="n">options</span> <span class="o">:=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;options&quot;</span><span class="p">):</span>
                <span class="n">o_type</span> <span class="o">=</span> <span class="n">options</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;type&quot;</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">o_type</span> <span class="ow">in</span> <span class="p">(</span><span class="n">OptionTypes</span><span class="o">.</span><span class="n">SUB_COMMAND</span><span class="p">,</span> <span class="n">OptionTypes</span><span class="o">.</span><span class="n">SUB_COMMAND_GROUP</span><span class="p">):</span>
                    <span class="c1"># this is a subcommand, process accordingly</span>
                    <span class="k">if</span> <span class="n">o_type</span> <span class="o">==</span> <span class="n">OptionTypes</span><span class="o">.</span><span class="n">SUB_COMMAND</span><span class="p">:</span>
                        <span class="n">invoked_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">invoked_name</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">options</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
                        <span class="n">options</span> <span class="o">=</span> <span class="n">options</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;options&quot;</span><span class="p">,</span> <span class="p">[])</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">invoked_name</span> <span class="o">=</span> <span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">invoked_name</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">options</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">next</span><span class="p">(</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">options</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;options&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">OptionTypes</span><span class="o">.</span><span class="n">SUB_COMMAND</span><span class="p">)[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
                        <span class="p">)</span>
                        <span class="n">options</span> <span class="o">=</span> <span class="n">options</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;options&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;options&quot;</span><span class="p">,</span> <span class="p">[])</span>

                <span class="k">for</span> <span class="n">option</span> <span class="ow">in</span> <span class="n">options</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="n">option</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">)</span>

                    <span class="c1"># todo change to match statement</span>
                    <span class="c1"># this block here resolves the options using the cache</span>
                    <span class="k">if</span> <span class="n">option</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">OptionTypes</span><span class="o">.</span><span class="n">USER</span><span class="p">:</span>
                        <span class="n">value</span> <span class="o">=</span> <span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">member_cache</span><span class="o">.</span><span class="n">get</span><span class="p">((</span><span class="n">to_snowflake</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;guild_id&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span> <span class="n">to_snowflake</span><span class="p">(</span><span class="n">value</span><span class="p">)))</span>
                            <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">user_cache</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">to_snowflake</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
                        <span class="p">)</span> <span class="ow">or</span> <span class="n">value</span>
                    <span class="k">elif</span> <span class="n">option</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">OptionTypes</span><span class="o">.</span><span class="n">CHANNEL</span><span class="p">:</span>
                        <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">channel_cache</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">to_snowflake</span><span class="p">(</span><span class="n">value</span><span class="p">))</span> <span class="ow">or</span> <span class="n">value</span>
                    <span class="k">elif</span> <span class="n">option</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">OptionTypes</span><span class="o">.</span><span class="n">ROLE</span><span class="p">:</span>
                        <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">role_cache</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">to_snowflake</span><span class="p">(</span><span class="n">value</span><span class="p">))</span> <span class="ow">or</span> <span class="n">value</span>
                    <span class="k">elif</span> <span class="n">option</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">OptionTypes</span><span class="o">.</span><span class="n">MENTIONABLE</span><span class="p">:</span>
                        <span class="n">snow</span> <span class="o">=</span> <span class="n">to_snowflake</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">user</span> <span class="o">:=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">member_cache</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">snow</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">user_cache</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">snow</span><span class="p">):</span>
                            <span class="n">value</span> <span class="o">=</span> <span class="n">user</span>
                        <span class="k">elif</span> <span class="n">role</span> <span class="o">:=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">role_cache</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">snow</span><span class="p">):</span>
                            <span class="n">value</span> <span class="o">=</span> <span class="n">role</span>
                    <span class="k">if</span> <span class="n">option</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;focused&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
                        <span class="bp">cls</span><span class="o">.</span><span class="n">focussed_option</span> <span class="o">=</span> <span class="n">option</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)</span>
                    <span class="n">kwargs</span><span class="p">[</span><span class="n">option</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span> <span class="o">=</span> <span class="n">value</span>

            <span class="bp">cls</span><span class="o">.</span><span class="n">invoked_name</span> <span class="o">=</span> <span class="n">invoked_name</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">kwargs</span> <span class="o">=</span> <span class="n">kwargs</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">values</span><span class="p">()]</span>

            <span class="k">return</span> <span class="bp">cls</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">MessageContext</span><span class="o">.</span><span class="n">from_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>

    <span class="nd">@listen</span><span class="p">(</span><span class="s2">&quot;raw_interaction_create&quot;</span><span class="p">)</span>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">_dispatch_interaction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="n">RawGatewayEvent</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Identify and dispatch interaction of slash commands or components.</span>

<span class="sd">        Args:</span>
<span class="sd">            raw interaction event</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">interaction_data</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">data</span>

        <span class="k">if</span> <span class="n">interaction_data</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span>
            <span class="n">InteractionTypes</span><span class="o">.</span><span class="n">PING</span><span class="p">,</span>
            <span class="n">InteractionTypes</span><span class="o">.</span><span class="n">APPLICATION_COMMAND</span><span class="p">,</span>
            <span class="n">InteractionTypes</span><span class="o">.</span><span class="n">AUTOCOMPLETE</span><span class="p">,</span>
        <span class="p">):</span>
            <span class="n">interaction_id</span> <span class="o">=</span> <span class="n">interaction_data</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;id&quot;</span><span class="p">]</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">interaction_data</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
            <span class="n">scope</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_interaction_scopes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">interaction_id</span><span class="p">))</span>

            <span class="k">if</span> <span class="n">scope</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">interactions</span><span class="p">:</span>
                <span class="n">ctx</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_context</span><span class="p">(</span><span class="n">interaction_data</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>

                <span class="n">command</span><span class="p">:</span> <span class="n">SlashCommand</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">interactions</span><span class="p">[</span><span class="n">scope</span><span class="p">][</span><span class="n">ctx</span><span class="o">.</span><span class="n">invoked_name</span><span class="p">]</span>  <span class="c1"># type: ignore</span>
                <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">scope</span><span class="si">}</span><span class="s2"> :: </span><span class="si">{</span><span class="n">command</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> should be called&quot;</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">auto_opt</span> <span class="o">:=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="s2">&quot;focussed_option&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
                    <span class="k">await</span> <span class="n">command</span><span class="o">.</span><span class="n">autocomplete_callbacks</span><span class="p">[</span><span class="n">auto_opt</span><span class="p">](</span><span class="n">ctx</span><span class="p">,</span> <span class="o">**</span><span class="n">ctx</span><span class="o">.</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="k">await</span> <span class="n">command</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="o">**</span><span class="n">ctx</span><span class="o">.</span><span class="n">kwargs</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_command_error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;cmd /`</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">`&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
                    <span class="k">finally</span><span class="p">:</span>
                        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_command</span><span class="p">(</span><span class="n">ctx</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown cmd_id received:: </span><span class="si">{</span><span class="n">interaction_id</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">interaction_data</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">InteractionTypes</span><span class="o">.</span><span class="n">MESSAGE_COMPONENT</span><span class="p">:</span>
            <span class="c1"># Buttons, Selects, ContextMenu::Message</span>
            <span class="n">ctx</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_context</span><span class="p">(</span><span class="n">interaction_data</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
            <span class="n">component_type</span> <span class="o">=</span> <span class="n">interaction_data</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;component_type&quot;</span><span class="p">]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">dispatch</span><span class="p">(</span><span class="n">events</span><span class="o">.</span><span class="n">Component</span><span class="p">(</span><span class="n">ctx</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">callback</span> <span class="o">:=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_component_callbacks</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ctx</span><span class="o">.</span><span class="n">custom_id</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">await</span> <span class="n">callback</span><span class="p">(</span><span class="n">ctx</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_command_error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Component Callback for </span><span class="si">{</span><span class="n">ctx</span><span class="o">.</span><span class="n">custom_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
                <span class="k">finally</span><span class="p">:</span>
                    <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_command</span><span class="p">(</span><span class="n">ctx</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">component_type</span> <span class="o">==</span> <span class="n">ComponentTypes</span><span class="o">.</span><span class="n">BUTTON</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dispatch</span><span class="p">(</span><span class="n">events</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="n">ctx</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">component_type</span> <span class="o">==</span> <span class="n">ComponentTypes</span><span class="o">.</span><span class="n">SELECT</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dispatch</span><span class="p">(</span><span class="n">events</span><span class="o">.</span><span class="n">Select</span><span class="p">(</span><span class="n">ctx</span><span class="p">))</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown Interaction Received: </span><span class="si">{</span><span class="n">interaction_data</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="nd">@listen</span><span class="p">(</span><span class="s2">&quot;message_create&quot;</span><span class="p">)</span>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">_dispatch_msg_commands</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="n">MessageCreate</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Determine if a command is being triggered, and dispatch it.&quot;&quot;&quot;</span>
        <span class="n">message</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">message</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">message</span><span class="o">.</span><span class="n">author</span><span class="o">.</span><span class="n">bot</span><span class="p">:</span>
            <span class="n">prefix</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_prefix</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">prefix</span> <span class="o">==</span> <span class="n">MENTION_PREFIX</span><span class="p">:</span>
                <span class="n">mention</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mention_reg</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">mention</span><span class="p">:</span>
                    <span class="n">prefix</span> <span class="o">=</span> <span class="n">mention</span><span class="o">.</span><span class="n">group</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span>

            <span class="k">if</span> <span class="n">message</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">prefix</span><span class="p">):</span>
                <span class="n">invoked_name</span> <span class="o">=</span> <span class="n">get_first_word</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">removeprefix</span><span class="p">(</span><span class="n">prefix</span><span class="p">))</span>
                <span class="n">command</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">commands</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">invoked_name</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">command</span> <span class="ow">and</span> <span class="n">command</span><span class="o">.</span><span class="n">enabled</span><span class="p">:</span>
                    <span class="n">context</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_context</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
                    <span class="n">context</span><span class="o">.</span><span class="n">invoked_name</span> <span class="o">=</span> <span class="n">invoked_name</span>
                    <span class="n">context</span><span class="o">.</span><span class="n">prefix</span> <span class="o">=</span> <span class="n">prefix</span>
                    <span class="n">context</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="n">get_args</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">content_parameters</span><span class="p">)</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="k">await</span> <span class="n">command</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_command_error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;cmd `</span><span class="si">{</span><span class="n">invoked_name</span><span class="si">}</span><span class="s2">`&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
                    <span class="k">finally</span><span class="p">:</span>
                        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_command</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_scale</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Scale</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get a scale</span>
<span class="sd">        Args:</span>
<span class="sd">            name: The name of the scale, or the name of it&#39;s extension</span>

<span class="sd">        Returns:</span>
<span class="sd">            Scale or None if no scale is found</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">scales</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">scale</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">scales</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">scale</span><span class="o">.</span><span class="n">extension_name</span> <span class="o">==</span> <span class="n">name</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">scale</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">scales</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">grow_scale</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">package</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A helper method to load a scale</span>

<span class="sd">        Args:</span>
<span class="sd">            file_name: The name of the file to load the scale from.</span>
<span class="sd">            package: The package this scale is in.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_extension</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">package</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">shed_scale</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scale_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Helper method to unload a scale</span>

<span class="sd">        Args:</span>
<span class="sd">            scale_name: The name of the scale to unload.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">scale</span> <span class="o">:=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_scale</span><span class="p">(</span><span class="n">scale_name</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">unload_extension</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">getmodule</span><span class="p">(</span><span class="n">scale</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>

        <span class="k">raise</span> <span class="n">ScaleLoadException</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unable to shed scale: No scale exists with name: `</span><span class="si">{</span><span class="n">scale_name</span><span class="si">}</span><span class="s2">`&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">regrow_scale</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scale_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Helper method to reload a scale.</span>

<span class="sd">        Args:</span>
<span class="sd">            scale_name: The name of the scale to reload</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shed_scale</span><span class="p">(</span><span class="n">scale_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grow_scale</span><span class="p">(</span><span class="n">scale_name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">load_extension</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">package</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Load an extension.</span>

<span class="sd">        Args:</span>
<span class="sd">            name: The name of the extension.</span>
<span class="sd">            package: The package the extension is in</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">importlib</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">resolve_name</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">package</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__extensions</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> already loaded&quot;</span><span class="p">)</span>

        <span class="n">module</span> <span class="o">=</span> <span class="n">importlib</span><span class="o">.</span><span class="n">import_module</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">package</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">setup</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="s2">&quot;setup&quot;</span><span class="p">)</span>
            <span class="n">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">del</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
            <span class="k">raise</span> <span class="n">ExtensionLoadException</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error loading </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">e</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Loaded Extension: </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__extensions</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">module</span>
            <span class="k">return</span>

    <span class="k">def</span> <span class="nf">unload_extension</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">package</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        unload an extension.</span>

<span class="sd">        Args:</span>
<span class="sd">            name: The name of the extension.</span>
<span class="sd">            package: The package the extension is in</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">importlib</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">resolve_name</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">package</span><span class="p">)</span>
        <span class="n">module</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__extensions</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">module</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ExtensionNotFound</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No extension called </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> is loaded&quot;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">teardown</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="s2">&quot;teardown&quot;</span><span class="p">)</span>
            <span class="n">teardown</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="k">if</span> <span class="n">scale</span> <span class="o">:=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_scale</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
            <span class="n">scale</span><span class="o">.</span><span class="n">shed</span><span class="p">()</span>

        <span class="k">del</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">__extensions</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">reload_extension</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">package</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Helper method to reload an extension.</span>
<span class="sd">        Simply unloads, then loads the extension.</span>

<span class="sd">        Args:</span>
<span class="sd">            name: The name of the extension.</span>
<span class="sd">            package: The package the extension is in</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">importlib</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">resolve_name</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">package</span><span class="p">)</span>
        <span class="n">module</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__extensions</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">module</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Attempted to reload extension thats not loaded. Loading extension instead&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_extension</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">package</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">unload_extension</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">package</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_extension</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">package</span><span class="p">)</span>

        <span class="c1"># todo: maybe add an ability to revert to the previous version if unable to load the new one</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">get_guild</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">guild_id</span><span class="p">:</span> <span class="s2">&quot;Snowflake_Type&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Guild</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get a guild</span>

<span class="sd">        Note:</span>
<span class="sd">            This method is an alias for the cache which will either return a cached object, or query discord for the object</span>
<span class="sd">            if its not already cached.</span>

<span class="sd">        Args:</span>
<span class="sd">            guild_id: The ID of the guild to get</span>

<span class="sd">        Returns:</span>
<span class="sd">            Guild Object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">get_guild</span><span class="p">(</span><span class="n">guild_id</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">get_channel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel_id</span><span class="p">:</span> <span class="s2">&quot;Snowflake_Type&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;TYPE_ALL_CHANNEL&quot;</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get a channel</span>

<span class="sd">        Note:</span>
<span class="sd">            This method is an alias for the cache which will either return a cached object, or query discord for the object</span>
<span class="sd">            if its not already cached.</span>

<span class="sd">        Args:</span>
<span class="sd">            channel_id: The ID of the channel to get</span>

<span class="sd">        Returns:</span>
<span class="sd">            Channel Object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">get_channel</span><span class="p">(</span><span class="n">channel_id</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">get_user</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_id</span><span class="p">:</span> <span class="s2">&quot;Snowflake_Type&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">User</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get a user</span>

<span class="sd">        Note:</span>
<span class="sd">            This method is an alias for the cache which will either return a cached object, or query discord for the object</span>
<span class="sd">            if its not already cached.</span>

<span class="sd">        Args:</span>
<span class="sd">            user_id: The ID of the user to get</span>

<span class="sd">        Returns:</span>
<span class="sd">            User Object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">get_user</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">get_member</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_id</span><span class="p">:</span> <span class="s2">&quot;Snowflake_Type&quot;</span><span class="p">,</span> <span class="n">guild_id</span><span class="p">:</span> <span class="s2">&quot;Snowflake_Type&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Member</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get a member from a guild</span>

<span class="sd">        Note:</span>
<span class="sd">            This method is an alias for the cache which will either return a cached object, or query discord for the object</span>
<span class="sd">            if its not already cached.</span>

<span class="sd">        Args:</span>
<span class="sd">            user_id: The ID of the member</span>
<span class="sd">            guild_id: The ID of the guild to get the member from</span>

<span class="sd">        Returns:</span>
<span class="sd">            Member object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">get_member</span><span class="p">(</span><span class="n">guild_id</span><span class="p">,</span> <span class="n">user_id</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">get_sticker</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sticker_id</span><span class="p">:</span> <span class="s2">&quot;Snowflake_Type&quot;</span><span class="p">):</span>
        <span class="n">sticker_data</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">http</span><span class="o">.</span><span class="n">get_sticker</span><span class="p">(</span><span class="n">sticker_id</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Sticker</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">sticker_data</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">get_nitro_packs</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="s2">&quot;StickerPack&quot;</span><span class="p">]:</span>
        <span class="n">packs_data</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">http</span><span class="o">.</span><span class="n">list_nitro_sticker_packs</span><span class="p">()</span>
        <span class="n">packs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">pack_data</span> <span class="ow">in</span> <span class="n">packs_data</span><span class="p">:</span>
            <span class="n">packs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">StickerPack</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">pack_data</span><span class="p">,</span> <span class="bp">self</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">packs</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">change_presence</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">status</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Status</span><span class="p">]]</span> <span class="o">=</span> <span class="n">Status</span><span class="o">.</span><span class="n">ONLINE</span><span class="p">,</span> <span class="n">activity</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">Activity</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Change the bots presence.</span>

<span class="sd">        Args:</span>
<span class="sd">            status: The status for the bot to be. i.e. online, afk, etc.</span>
<span class="sd">            activity: The activity for the bot to be displayed as doing.</span>

<span class="sd">        note::</span>
<span class="sd">            Bots may only be `playing` `streaming` or `listening`, other activity types are likely to fail.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">activity</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">activity</span><span class="p">,</span> <span class="n">Activity</span><span class="p">):</span>
                <span class="c1"># squash whatever the user passed into an activity</span>
                <span class="n">activity</span> <span class="o">=</span> <span class="n">Activity</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">activity</span><span class="p">))</span>

            <span class="k">if</span> <span class="n">activity</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">ActivityType</span><span class="o">.</span><span class="n">STREAMING</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">activity</span><span class="o">.</span><span class="n">url</span><span class="p">:</span>
                    <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Streaming activity cannot be set without a valid URL attribute&quot;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">activity</span><span class="o">.</span><span class="n">type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="n">ActivityType</span><span class="o">.</span><span class="n">GAME</span><span class="p">,</span> <span class="n">ActivityType</span><span class="o">.</span><span class="n">STREAMING</span><span class="p">,</span> <span class="n">ActivityType</span><span class="o">.</span><span class="n">LISTENING</span><span class="p">]:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Activity type `</span><span class="si">{</span><span class="n">ActivityType</span><span class="p">(</span><span class="n">activity</span><span class="o">.</span><span class="n">type</span><span class="p">)</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">` may not be enabled for bots&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">activity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_activity</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_activity</span> <span class="k">else</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="n">status</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">status</span><span class="p">,</span> <span class="n">Status</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">status</span> <span class="o">=</span> <span class="n">Status</span><span class="p">[</span><span class="n">status</span><span class="o">.</span><span class="n">upper</span><span class="p">()]</span>
                <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;`</span><span class="si">{</span><span class="n">status</span><span class="si">}</span><span class="s2">` is not a valid status type. Please use the Status enum&quot;</span><span class="p">)</span> <span class="kn">from</span> <span class="bp">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># in case the user set status to None</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_status</span><span class="p">:</span>
                <span class="n">status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_status</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Status must be set to a valid status type, defaulting to online&quot;</span><span class="p">)</span>
                <span class="n">status</span> <span class="o">=</span> <span class="n">Status</span><span class="o">.</span><span class="n">ONLINE</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_status</span> <span class="o">=</span> <span class="n">status</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_activity</span> <span class="o">=</span> <span class="n">activity</span>
        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">ws</span><span class="o">.</span><span class="n">change_presence</span><span class="p">(</span><span class="n">activity</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span> <span class="k">if</span> <span class="n">activity</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span> <span class="n">status</span><span class="p">)</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">




  <div class="doc doc-object doc-attribute">



<h3 id="dis_snek.client.Snake.is_closed" class="doc doc-heading">

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

<code class="highlight language-python"><span class="n">is_closed</span><span class="p">:</span> <span class="nb">bool</span></code>

<a href="#dis_snek.client.Snake.is_closed" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Is the bot closed?</p>
    </div>

  </div>








  <div class="doc doc-object doc-attribute">



<h3 id="dis_snek.client.Snake.latency" class="doc doc-heading">

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

<code class="highlight language-python"><span class="n">latency</span><span class="p">:</span> <span class="nb">float</span></code>

<a href="#dis_snek.client.Snake.latency" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Returns the latency of the websocket connection</p>
    </div>

  </div>





  <div class="doc doc-object doc-attribute">



<h3 id="dis_snek.client.Snake.user" class="doc doc-heading">

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

<code class="highlight language-python"><span class="n">user</span><span class="p">:</span> <span class="n">SnakeBotUser</span></code>

<a href="#dis_snek.client.Snake.user" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Returns the bot's user</p>
    </div>

  </div>





  <div class="doc doc-object doc-attribute">



<h3 id="dis_snek.client.Snake.app" class="doc doc-heading">

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

<code class="highlight language-python"><span class="n">app</span><span class="p">:</span> <span class="n">Application</span></code>

<a href="#dis_snek.client.Snake.app" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Returns the bots application</p>
    </div>

  </div>





  <div class="doc doc-object doc-attribute">



<h3 id="dis_snek.client.Snake.owner" class="doc doc-heading">

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

<code class="highlight language-python"><span class="n">owner</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">User</span><span class="p">]</span></code>

<a href="#dis_snek.client.Snake.owner" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Returns the bot's owner'</p>
    </div>

  </div>








  <div class="doc doc-object doc-attribute">



<h3 id="dis_snek.client.Snake.status" class="doc doc-heading">

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

<code class="highlight language-python"><span class="n">status</span><span class="p">:</span> <span class="n">Status</span></code>

<a href="#dis_snek.client.Snake.status" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Get the status of the bot. IE online, afk, dnd</p>
    </div>

  </div>





  <div class="doc doc-object doc-attribute">



<h3 id="dis_snek.client.Snake.activity" class="doc doc-heading">

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

<code class="highlight language-python"><span class="n">activity</span><span class="p">:</span> <span class="n">Activity</span></code>

<a href="#dis_snek.client.Snake.activity" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Get the activity of the bot</p>
    </div>

  </div>





  <div class="doc doc-object doc-attribute">



<h3 id="dis_snek.client.Snake.application_commands" class="doc doc-heading">

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

<code class="highlight language-python"><span class="n">application_commands</span></code>

<a href="#dis_snek.client.Snake.application_commands" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>a list of all application commands registered within the bot</p>
    </div>

  </div>





  <div class="doc doc-object doc-method">



<h3 id="dis_snek.client.Snake.get_prefix" class="doc doc-heading">

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-async"><code>async</code></small>
  </span>

<code class="highlight language-python"><span class="n">get_prefix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span></code>
<a href="#dis_snek.client.Snake.get_prefix" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>A method to get the bot's default_prefix, can be overridden to add dynamic prefixes.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>To easily override this method, simply use the <code>get_prefix</code> parameter when instantiating the client</p>
</div>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>message</code></td>
        <td><code>Message</code></td>
        <td><p>A message to determine the prefix from.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>str</code></td>
      <td><p>A string to use as a prefix, by default will return <code>client.default_prefix</code></p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>dis_snek/client.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">async</span> <span class="k">def</span> <span class="nf">get_prefix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="n">Message</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;A method to get the bot&#39;s default_prefix, can be overridden to add dynamic prefixes.</span>

<span class="sd">    !!! note</span>
<span class="sd">        To easily override this method, simply use the `get_prefix` parameter when instantiating the client</span>

<span class="sd">    Args:</span>
<span class="sd">        message: A message to determine the prefix from.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A string to use as a prefix, by default will return `client.default_prefix`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_prefix</span>
</code></pre></div>
        </details>
    </div>

  </div>





  <div class="doc doc-object doc-method">



<h3 id="dis_snek.client.Snake.login" class="doc doc-heading">

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-async"><code>async</code></small>
  </span>

<code class="highlight language-python"><span class="n">login</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">token</span><span class="p">)</span></code>
<a href="#dis_snek.client.Snake.login" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Login to discord</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>token</code></td>
        <td><code>str</code></td>
        <td><p>Your bot's token</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>dis_snek/client.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">async</span> <span class="k">def</span> <span class="nf">login</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">token</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Login to discord</span>

<span class="sd">    Args:</span>
<span class="sd">        token str: Your bot&#39;s token</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># i needed somewhere to put this call,</span>
    <span class="c1"># login will always run after initialisation</span>
    <span class="c1"># so im gathering commands here</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_gather_commands</span><span class="p">()</span>

    <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Attempting to login&quot;</span><span class="p">)</span>
    <span class="n">me</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">http</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_user</span> <span class="o">=</span> <span class="n">SnakeBotUser</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">me</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">place_user_data</span><span class="p">(</span><span class="n">me</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_app</span> <span class="o">=</span> <span class="n">Application</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">http</span><span class="o">.</span><span class="n">get_current_bot_information</span><span class="p">(),</span> <span class="bp">self</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_mention_reg</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">fr</span><span class="s2">&quot;^(&lt;@!?</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">*&gt;\s)&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">start_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">dispatch</span><span class="p">(</span><span class="n">events</span><span class="o">.</span><span class="n">Login</span><span class="p">())</span>
    <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ws_connect</span><span class="p">()</span>
</code></pre></div>
        </details>
    </div>

  </div>





  <div class="doc doc-object doc-method">



<h3 id="dis_snek.client.Snake.on_error" class="doc doc-heading">

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-async"><code>async</code></small>
  </span>

<code class="highlight language-python"><span class="n">on_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">error</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>
<a href="#dis_snek.client.Snake.on_error" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Catches all errors dispatched by the library.</p>
<p>By default it will format and print them to console</p>
<p>Override this to change error handling behaviour</p>

        <details class="quote">
          <summary>Source code in <code>dis_snek/client.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">async</span> <span class="k">def</span> <span class="nf">on_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">error</span><span class="p">:</span> <span class="ne">Exception</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Catches all errors dispatched by the library.</span>

<span class="sd">    By default it will format and print them to console</span>

<span class="sd">    Override this to change error handling behaviour</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Ignoring exception in </span><span class="si">{</span><span class="n">source</span><span class="si">}</span><span class="s2">:</span><span class="se">\n</span><span class="si">{</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>





  <div class="doc doc-object doc-method">



<h3 id="dis_snek.client.Snake.on_command_error" class="doc doc-heading">

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-async"><code>async</code></small>
  </span>

<code class="highlight language-python"><span class="n">on_command_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">error</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>
<a href="#dis_snek.client.Snake.on_command_error" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Catches all errors dispatched by commands</p>
<p>By default it will call <code>Snake.on_error</code></p>
<p>Override this to change error handling behavior</p>

        <details class="quote">
          <summary>Source code in <code>dis_snek/client.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">async</span> <span class="k">def</span> <span class="nf">on_command_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">error</span><span class="p">:</span> <span class="ne">Exception</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Catches all errors dispatched by commands</span>

<span class="sd">    By default it will call `Snake.on_error`</span>

<span class="sd">    Override this to change error handling behavior</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_error</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">error</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>





  <div class="doc doc-object doc-method">



<h3 id="dis_snek.client.Snake.on_command" class="doc doc-heading">

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-async"><code>async</code></small>
  </span>

<code class="highlight language-python"><span class="n">on_command</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ctx</span><span class="p">)</span></code>
<a href="#dis_snek.client.Snake.on_command" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Called <em>after</em> any command is ran</p>
<p>By default, it will simply log the command, override this to change that behaviour</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>ctx</code></td>
        <td><code>Context</code></td>
        <td><p>The context of the command that was called</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>dis_snek/client.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">async</span> <span class="k">def</span> <span class="nf">on_command</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ctx</span><span class="p">:</span> <span class="n">Context</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Called *after* any command is ran</span>

<span class="sd">    By default, it will simply log the command, override this to change that behaviour</span>
<span class="sd">    Args:</span>
<span class="sd">        ctx: The context of the command that was called</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">MessageContext</span><span class="p">):</span>
        <span class="n">symbol</span> <span class="o">=</span> <span class="s2">&quot;@&quot;</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">ComponentContext</span><span class="p">):</span>
        <span class="n">symbol</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">InteractionContext</span><span class="p">):</span>
        <span class="n">symbol</span> <span class="o">=</span> <span class="s2">&quot;/&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">symbol</span> <span class="o">=</span> <span class="s2">&quot;?&quot;</span>  <span class="c1"># likely custom context</span>
    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Command Called: </span><span class="si">{</span><span class="n">symbol</span><span class="si">}{</span><span class="n">ctx</span><span class="o">.</span><span class="n">invoked_name</span><span class="si">}</span><span class="s2"> with </span><span class="si">{</span><span class="n">ctx</span><span class="o">.</span><span class="n">args</span> <span class="si">= }</span><span class="s2"> | </span><span class="si">{</span><span class="n">ctx</span><span class="o">.</span><span class="n">kwargs</span> <span class="si">= }</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>





  <div class="doc doc-object doc-method">



<h3 id="dis_snek.client.Snake.start" class="doc doc-heading">


<code class="highlight language-python"><span class="n">start</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">token</span><span class="p">)</span></code>
<a href="#dis_snek.client.Snake.start" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Start the bot.</p>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>This is the recommended method to start the bot</p>
</div>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>token</code></td>
        <td><code>str</code></td>
        <td><p>Your bot's token</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>dis_snek/client.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">token</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Start the bot.</span>

<span class="sd">    info:</span>
<span class="sd">        This is the recommended method to start the bot</span>

<span class="sd">    Args:</span>
<span class="sd">        token str: Your bot&#39;s token</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">run_until_complete</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">token</span><span class="p">))</span>
    <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">run_until_complete</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="p">())</span>
</code></pre></div>
        </details>
    </div>

  </div>








  <div class="doc doc-object doc-method">



<h3 id="dis_snek.client.Snake.dispatch" class="doc doc-heading">


<code class="highlight language-python"><span class="n">dispatch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>
<a href="#dis_snek.client.Snake.dispatch" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Dispatch an event.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>event</code></td>
        <td><code>BaseEvent</code></td>
        <td><p>The event to be dispatched.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>dis_snek/client.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">dispatch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="n">events</span><span class="o">.</span><span class="n">BaseEvent</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Dispatch an event.</span>

<span class="sd">    Args:</span>
<span class="sd">        event: The event to be dispatched.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Dispatching Event: </span><span class="si">{</span><span class="n">event</span><span class="o">.</span><span class="n">resolved_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">listeners</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">listeners</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">resolved_name</span><span class="p">,</span> <span class="p">[])</span>
    <span class="k">for</span> <span class="n">_listen</span> <span class="ow">in</span> <span class="n">listeners</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_queue_task</span><span class="p">(</span><span class="n">_listen</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">BotException</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;An error occurred attempting during </span><span class="si">{</span><span class="n">event</span><span class="o">.</span><span class="n">resolved_name</span><span class="si">}</span><span class="s2"> event processing&quot;</span><span class="p">)</span>

    <span class="n">_waits</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">waits</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">resolved_name</span><span class="p">,</span> <span class="p">[])</span>
    <span class="n">index_to_remove</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">_wait</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">_waits</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">_wait</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">result</span><span class="p">:</span>
            <span class="n">index_to_remove</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">index_to_remove</span><span class="p">:</span>
        <span class="n">_waits</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>





  <div class="doc doc-object doc-method">



<h3 id="dis_snek.client.Snake.wait_for" class="doc doc-heading">


<code class="highlight language-python"><span class="n">wait_for</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">checks</span><span class="o">=</span><span class="n">MISSING</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>
<a href="#dis_snek.client.Snake.wait_for" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Waits for a WebSocket event to be dispatched.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>event</code></td>
        <td><code>str</code></td>
        <td><p>The name of event to wait.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>checks</code></td>
        <td><code>Optional[Callable[..., bool]]</code></td>
        <td><p>A predicate to check what to wait for.</p></td>
        <td><code>MISSING</code></td>
      </tr>
      <tr>
        <td><code>timeout</code></td>
        <td><code>Optional[float]</code></td>
        <td><p>The number of seconds to wait before timing out.</p></td>
        <td><code>None</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td></td>
      <td><p>The event object.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>dis_snek/client.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">wait_for</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">checks</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]]</span> <span class="o">=</span> <span class="n">MISSING</span><span class="p">,</span> <span class="n">timeout</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Waits for a WebSocket event to be dispatched.</span>

<span class="sd">    Args:</span>
<span class="sd">        event: The name of event to wait.</span>
<span class="sd">        checks: A predicate to check what to wait for.</span>
<span class="sd">        timeout: The number of seconds to wait before timing out.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The event object.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">event</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">waits</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">waits</span><span class="p">[</span><span class="n">event</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">future</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">create_future</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">waits</span><span class="p">[</span><span class="n">event</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Wait</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">checks</span><span class="p">,</span> <span class="n">future</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">wait_for</span><span class="p">(</span><span class="n">future</span><span class="p">,</span> <span class="n">timeout</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>





  <div class="doc doc-object doc-method">



<h3 id="dis_snek.client.Snake.wait_for_component" class="doc doc-heading">

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-async"><code>async</code></small>
  </span>

<code class="highlight language-python"><span class="n">wait_for_component</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">messages</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">components</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">check</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>
<a href="#dis_snek.client.Snake.wait_for_component" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Waits for a message to be sent to the bot.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>messages</code></td>
        <td><code>Union[dis_snek.models.discord_objects.message.Message, int, list]</code></td>
        <td><p>The message object to check for.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>components</code></td>
        <td><code>Union[List[List[Union[BaseComponent, dict]]], List[Union[BaseComponent, dict]], BaseComponent, dict]</code></td>
        <td><p>The components to wait for.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>check</code></td>
        <td></td>
        <td><p>A predicate to check what to wait for.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>timeout</code></td>
        <td></td>
        <td><p>The number of seconds to wait before timing out.</p></td>
        <td><code>None</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>Awaitable[Future]</code></td>
      <td><p><code>Component</code> that was invoked, or <code>None</code> if timed out. Use <code>.context</code> to get the <code>ComponentContext</code>.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>dis_snek/client.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">async</span> <span class="k">def</span> <span class="nf">wait_for_component</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">messages</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Message</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">list</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">components</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span>
        <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="s2">&quot;BaseComponent&quot;</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]]],</span> <span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="s2">&quot;BaseComponent&quot;</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]],</span> <span class="s2">&quot;BaseComponent&quot;</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]</span>
    <span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">check</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">timeout</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Awaitable</span><span class="p">[</span><span class="s2">&quot;Future&quot;</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Waits for a message to be sent to the bot.</span>

<span class="sd">    Args:</span>
<span class="sd">        messages: The message object to check for.</span>
<span class="sd">        components: The components to wait for.</span>
<span class="sd">        check: A predicate to check what to wait for.</span>
<span class="sd">        timeout: The number of seconds to wait before timing out.</span>

<span class="sd">    Returns:</span>
<span class="sd">        `Component` that was invoked, or `None` if timed out. Use `.context` to get the `ComponentContext`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">messages</span> <span class="ow">or</span> <span class="n">components</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;You must specify messages or components (or both)&quot;</span><span class="p">)</span>

    <span class="n">message_ids</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">to_snowflake_list</span><span class="p">(</span><span class="n">messages</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">messages</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="n">to_snowflake</span><span class="p">(</span><span class="n">messages</span><span class="p">)</span> <span class="k">if</span> <span class="n">messages</span> <span class="k">else</span> <span class="kc">None</span>
    <span class="p">)</span>
    <span class="n">custom_ids</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">get_components_ids</span><span class="p">(</span><span class="n">components</span><span class="p">))</span> <span class="k">if</span> <span class="n">components</span> <span class="k">else</span> <span class="kc">None</span>

    <span class="c1"># automatically convert improper custom_ids</span>
    <span class="k">if</span> <span class="n">custom_ids</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">custom_ids</span><span class="p">):</span>
        <span class="n">custom_ids</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">custom_ids</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_check</span><span class="p">(</span><span class="n">event</span><span class="p">:</span> <span class="n">Component</span><span class="p">):</span>
        <span class="n">ctx</span><span class="p">:</span> <span class="n">ComponentContext</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">context</span>
        <span class="c1"># if custom_ids is empty or there is a match</span>
        <span class="n">wanted_message</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">message_ids</span> <span class="ow">or</span> <span class="n">ctx</span><span class="o">.</span><span class="n">message</span><span class="o">.</span><span class="n">id</span> <span class="ow">in</span> <span class="p">(</span>
            <span class="p">[</span><span class="n">message_ids</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">message_ids</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="k">else</span> <span class="n">message_ids</span>
        <span class="p">)</span>
        <span class="n">wanted_component</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">custom_ids</span> <span class="ow">or</span> <span class="n">ctx</span><span class="o">.</span><span class="n">custom_id</span> <span class="ow">in</span> <span class="n">custom_ids</span>
        <span class="k">if</span> <span class="n">wanted_message</span> <span class="ow">and</span> <span class="n">wanted_component</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">check</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">check</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
                <span class="k">return</span> <span class="kc">True</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">wait_for</span><span class="p">(</span><span class="s2">&quot;component&quot;</span><span class="p">,</span> <span class="n">checks</span><span class="o">=</span><span class="n">_check</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>





  <div class="doc doc-object doc-method">



<h3 id="dis_snek.client.Snake.add_listener" class="doc doc-heading">


<code class="highlight language-python"><span class="n">add_listener</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">listener</span><span class="p">)</span></code>
<a href="#dis_snek.client.Snake.add_listener" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Add a listener for an event, if no event is passed, one is determined</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>coro</code></td>
        <td><code>Listener</code></td>
        <td><p>The listener to add to the client</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>dis_snek/client.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">add_listener</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">listener</span><span class="p">:</span> <span class="n">Listener</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Add a listener for an event, if no event is passed, one is determined</span>

<span class="sd">    Args:</span>
<span class="sd">        coro Listener: The listener to add to the client</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">listener</span><span class="o">.</span><span class="n">event</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">listeners</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">listeners</span><span class="p">[</span><span class="n">listener</span><span class="o">.</span><span class="n">event</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">listeners</span><span class="p">[</span><span class="n">listener</span><span class="o">.</span><span class="n">event</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">listener</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>





  <div class="doc doc-object doc-method">



<h3 id="dis_snek.client.Snake.add_interaction" class="doc doc-heading">


<code class="highlight language-python"><span class="n">add_interaction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">)</span></code>
<a href="#dis_snek.client.Snake.add_interaction" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Add a slash command to the client.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>command</code></td>
        <td><code>InteractionCommand</code></td>
        <td><p>The command to add</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>dis_snek/client.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">add_interaction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">:</span> <span class="n">InteractionCommand</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Add a slash command to the client.</span>

<span class="sd">    Args:</span>
<span class="sd">        command InteractionCommand: The command to add</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug_scope</span><span class="p">:</span>
        <span class="n">command</span><span class="o">.</span><span class="n">scopes</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">debug_scope</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">scope</span> <span class="ow">in</span> <span class="n">command</span><span class="o">.</span><span class="n">scopes</span><span class="p">:</span>

        <span class="k">if</span> <span class="n">scope</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">interactions</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">interactions</span><span class="p">[</span><span class="n">scope</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">elif</span> <span class="n">command</span><span class="o">.</span><span class="n">resolved_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">interactions</span><span class="p">[</span><span class="n">scope</span><span class="p">]:</span>
            <span class="n">old_cmd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">interactions</span><span class="p">[</span><span class="n">scope</span><span class="p">][</span><span class="n">command</span><span class="o">.</span><span class="n">resolved_name</span><span class="p">]</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Duplicate Command! </span><span class="si">{</span><span class="n">scope</span><span class="si">}</span><span class="s2">::</span><span class="si">{</span><span class="n">old_cmd</span><span class="o">.</span><span class="n">resolved_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">interactions</span><span class="p">[</span><span class="n">scope</span><span class="p">][</span><span class="n">command</span><span class="o">.</span><span class="n">resolved_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">command</span>
</code></pre></div>
        </details>
    </div>

  </div>





  <div class="doc doc-object doc-method">



<h3 id="dis_snek.client.Snake.add_message_command" class="doc doc-heading">


<code class="highlight language-python"><span class="n">add_message_command</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">)</span></code>
<a href="#dis_snek.client.Snake.add_message_command" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Add a message command to the client.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>command</code></td>
        <td><code>InteractionCommand</code></td>
        <td><p>The command to add</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>dis_snek/client.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">add_message_command</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">:</span> <span class="n">MessageCommand</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Add a message command to the client.</span>

<span class="sd">    Args:</span>
<span class="sd">        command InteractionCommand: The command to add</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">command</span><span class="o">.</span><span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">commands</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">commands</span><span class="p">[</span><span class="n">command</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">command</span>
        <span class="k">return</span>
    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Duplicate Command! Multiple commands share the name `</span><span class="si">{</span><span class="n">command</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">`&quot;</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>





  <div class="doc doc-object doc-method">



<h3 id="dis_snek.client.Snake.add_component_callback" class="doc doc-heading">


<code class="highlight language-python"><span class="n">add_component_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">)</span></code>
<a href="#dis_snek.client.Snake.add_component_callback" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Add a component callback to the client</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>command</code></td>
        <td><code>ComponentCommand</code></td>
        <td><p>The command to add</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>dis_snek/client.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">add_component_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">:</span> <span class="n">ComponentCommand</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Add a component callback to the client</span>

<span class="sd">    Args:</span>
<span class="sd">        command: The command to add</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">listener</span> <span class="ow">in</span> <span class="n">command</span><span class="o">.</span><span class="n">listeners</span><span class="p">:</span>
        <span class="c1"># I know this isn&#39;t an ideal solution, but it means we can lookup callbacks with O(1)</span>
        <span class="k">if</span> <span class="n">listener</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_component_callbacks</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_component_callbacks</span><span class="p">[</span><span class="n">listener</span><span class="p">]</span> <span class="o">=</span> <span class="n">command</span>
            <span class="k">continue</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Duplicate Component! Multiple component callbacks for `</span><span class="si">{</span><span class="n">listener</span><span class="si">}</span><span class="s2">`&quot;</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>





  <div class="doc doc-object doc-method">



<h3 id="dis_snek.client.Snake.synchronise_interactions" class="doc doc-heading">

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-async"><code>async</code></small>
  </span>

<code class="highlight language-python"><span class="n">synchronise_interactions</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>
<a href="#dis_snek.client.Snake.synchronise_interactions" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Synchronise registered interactions with discord</p>
<p>One flaw of this is it cant determine if context menus need updating,
as discord isn't returning that data on get req, so they are unnecessarily updated</p>

        <details class="quote">
          <summary>Source code in <code>dis_snek/client.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">async</span> <span class="k">def</span> <span class="nf">synchronise_interactions</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Synchronise registered interactions with discord</span>

<span class="sd">    One flaw of this is it cant determine if context menus need updating,</span>
<span class="sd">    as discord isn&#39;t returning that data on get req, so they are unnecessarily updated&quot;&quot;&quot;</span>

    <span class="c1"># first we need to make sure our local copy of cmd_ids is up-to-date</span>
    <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cache_interactions</span><span class="p">()</span>
    <span class="n">cmd_scopes</span> <span class="o">=</span> <span class="p">[</span><span class="n">to_snowflake</span><span class="p">(</span><span class="n">g_id</span><span class="p">)</span> <span class="k">for</span> <span class="n">g_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_user</span><span class="o">.</span><span class="n">_guild_ids</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">GLOBAL_SCOPE</span><span class="p">]</span>

    <span class="n">guild_perms</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="n">cmds_json</span> <span class="o">=</span> <span class="n">application_commands_to_dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">interactions</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">cmd_scope</span> <span class="ow">in</span> <span class="n">cmd_scopes</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">cmds_resp_data</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">http</span><span class="o">.</span><span class="n">get_interaction_element</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">cmd_scope</span><span class="p">)</span>
            <span class="n">need_to_sync</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">cmds_to_sync</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">found</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="k">for</span> <span class="n">local_cmd</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">interactions</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">cmd_scope</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="c1"># try and find remote equiv of this command</span>
                <span class="n">remote_cmd</span> <span class="o">=</span> <span class="nb">next</span><span class="p">((</span><span class="n">v</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">cmds_resp_data</span> <span class="k">if</span> <span class="n">v</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">local_cmd</span><span class="o">.</span><span class="n">cmd_id</span><span class="p">),</span> <span class="kc">None</span><span class="p">)</span>

                <span class="n">local_cmd</span> <span class="o">=</span> <span class="nb">next</span><span class="p">((</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">cmds_json</span><span class="p">[</span><span class="n">cmd_scope</span><span class="p">]</span> <span class="k">if</span> <span class="n">c</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">local_cmd</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>

                <span class="k">if</span> <span class="n">local_cmd</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">cmds_to_sync</span><span class="p">:</span>
                    <span class="n">cmds_to_sync</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">local_cmd</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">remote_cmd</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">found</span><span class="p">:</span>
                    <span class="n">found</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">remote_cmd</span><span class="p">)</span>

                <span class="c1"># todo: prevent un-needed syncs for subcommands</span>
                <span class="k">if</span> <span class="n">sync_needed</span><span class="p">(</span><span class="n">local_cmd</span><span class="p">,</span> <span class="n">remote_cmd</span><span class="p">):</span>
                    <span class="c1"># if command local data doesnt match remote, a change has been made, sync it</span>
                    <span class="n">need_to_sync</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="k">if</span> <span class="n">need_to_sync</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Updating </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">cmds_to_sync</span><span class="p">)</span><span class="si">}</span><span class="s2"> commands in </span><span class="si">{</span><span class="n">cmd_scope</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">cmd_sync_resp</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">http</span><span class="o">.</span><span class="n">post_interaction_element</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">cmds_to_sync</span><span class="p">,</span> <span class="n">guild_id</span><span class="o">=</span><span class="n">cmd_scope</span>
                <span class="p">)</span>
                <span class="c1"># cache cmd_ids and their scopes</span>
                <span class="k">for</span> <span class="n">cmd_data</span> <span class="ow">in</span> <span class="n">cmd_sync_resp</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_interaction_scopes</span><span class="p">[</span><span class="n">cmd_data</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">cmd_scope</span>
                    <span class="k">if</span> <span class="n">cmd_data</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">interactions</span><span class="p">[</span><span class="n">cmd_scope</span><span class="p">]:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">interactions</span><span class="p">[</span><span class="n">cmd_scope</span><span class="p">][</span><span class="n">cmd_data</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">cmd_id</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">cmd_data</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">])</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c1"># sub_cmd</span>
                        <span class="k">for</span> <span class="n">sc</span> <span class="ow">in</span> <span class="n">cmd_data</span><span class="p">[</span><span class="s2">&quot;options&quot;</span><span class="p">]:</span>
                            <span class="k">if</span> <span class="n">sc</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">OptionTypes</span><span class="o">.</span><span class="n">SUB_COMMAND</span><span class="p">:</span>
                                <span class="k">if</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">cmd_data</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">sc</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">interactions</span><span class="p">[</span><span class="n">cmd_scope</span><span class="p">]:</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">interactions</span><span class="p">[</span><span class="n">cmd_scope</span><span class="p">][</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">cmd_data</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">sc</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">cmd_id</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
                                        <span class="n">cmd_data</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span>
                                    <span class="p">)</span>
                            <span class="k">elif</span> <span class="n">sc</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">OptionTypes</span><span class="o">.</span><span class="n">SUB_COMMAND_GROUP</span><span class="p">:</span>
                                <span class="k">for</span> <span class="n">_sc</span> <span class="ow">in</span> <span class="n">sc</span><span class="p">[</span><span class="s2">&quot;options&quot;</span><span class="p">]:</span>
                                    <span class="k">if</span> <span class="p">(</span>
                                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">cmd_data</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">sc</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">_sc</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
                                        <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">interactions</span><span class="p">[</span><span class="n">cmd_scope</span><span class="p">]</span>
                                    <span class="p">):</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">interactions</span><span class="p">[</span><span class="n">cmd_scope</span><span class="p">][</span>
                                            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">cmd_data</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">sc</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">_sc</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
                                        <span class="p">]</span><span class="o">.</span><span class="n">cmd_id</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">cmd_data</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">])</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">cmd_scope</span><span class="si">}</span><span class="s2"> is already up-to-date with </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">cmds_resp_data</span><span class="p">)</span><span class="si">}</span><span class="s2"> commands.&quot;</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">local_cmd</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">interactions</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">cmd_scope</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">local_cmd</span><span class="o">.</span><span class="n">permissions</span><span class="p">:</span>
                    <span class="k">continue</span>

                <span class="k">for</span> <span class="n">perm_scope</span><span class="p">,</span> <span class="n">perms</span> <span class="ow">in</span> <span class="n">local_cmd</span><span class="o">.</span><span class="n">permissions</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">perm_scope</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">guild_perms</span><span class="p">:</span>
                        <span class="n">guild_perms</span><span class="p">[</span><span class="n">perm_scope</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="n">guild_perms</span><span class="p">[</span><span class="n">perm_scope</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">local_cmd</span><span class="o">.</span><span class="n">cmd_id</span><span class="p">,</span> <span class="s2">&quot;permissions&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">perm</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span> <span class="k">for</span> <span class="n">perm</span> <span class="ow">in</span> <span class="n">perms</span><span class="p">]}</span>
                    <span class="p">)</span>

            <span class="k">for</span> <span class="n">perm_scope</span> <span class="ow">in</span> <span class="n">guild_perms</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Updating </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">guild_perms</span><span class="p">[</span><span class="n">perm_scope</span><span class="p">])</span><span class="si">}</span><span class="s2"> command permissions in </span><span class="si">{</span><span class="n">perm_scope</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">http</span><span class="o">.</span><span class="n">batch_edit_application_command_permissions</span><span class="p">(</span>
                    <span class="n">application_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">scope</span><span class="o">=</span><span class="n">perm_scope</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">guild_perms</span><span class="p">[</span><span class="n">perm_scope</span><span class="p">]</span>
                <span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">del_unused_app_cmd</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">cmd</span> <span class="ow">in</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">cmds_resp_data</span> <span class="k">if</span> <span class="n">c</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">found</span><span class="p">]:</span>
                    <span class="n">scope</span> <span class="o">=</span> <span class="n">cmd</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;guild_id&quot;</span><span class="p">,</span> <span class="n">GLOBAL_SCOPE</span><span class="p">)</span>
                    <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Deleting unimplemented slash command </span><span class="se">\&quot;</span><span class="s2">/</span><span class="si">{</span><span class="n">cmd</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="se">\&quot;</span><span class="s2"> from scope &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;global&#39;</span> <span class="k">if</span> <span class="n">scope</span> <span class="o">==</span> <span class="n">GLOBAL_SCOPE</span> <span class="k">else</span> <span class="n">scope</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="p">)</span>
                    <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">http</span><span class="o">.</span><span class="n">delete_interaction_element</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">cmd</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;guild_id&quot;</span><span class="p">,</span> <span class="n">GLOBAL_SCOPE</span><span class="p">),</span> <span class="n">cmd</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span>
                    <span class="p">)</span>
        <span class="k">except</span> <span class="n">Forbidden</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InteractionMissingAccess</span><span class="p">(</span><span class="n">cmd_scope</span><span class="p">)</span> <span class="kn">from</span> <span class="bp">None</span>
</code></pre></div>
        </details>
    </div>

  </div>





  <div class="doc doc-object doc-method">



<h3 id="dis_snek.client.Snake.get_context" class="doc doc-heading">

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-async"><code>async</code></small>
  </span>

<code class="highlight language-python"><span class="n">get_context</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">interaction</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>
<a href="#dis_snek.client.Snake.get_context" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Return a context object based on data passed</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you want to use custom context objects, this is the method to override. Your replacement must take the same arguments as this, and return a Context-like object.</p>
</div>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>data</code></td>
        <td><code>Union[dict, dis_snek.models.discord_objects.message.Message]</code></td>
        <td><p>The data of the event</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>interaction</code></td>
        <td><code>bool</code></td>
        <td><p>Is this an interaction or not?</p></td>
        <td><code>False</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>Union[dis_snek.models.context.MessageContext, dis_snek.models.context.InteractionContext, dis_snek.models.context.ComponentContext, dis_snek.models.context.AutocompleteContext]</code></td>
      <td><p>Context object</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>dis_snek/client.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">async</span> <span class="k">def</span> <span class="nf">get_context</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">dict</span><span class="p">,</span> <span class="n">Message</span><span class="p">],</span> <span class="n">interaction</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">MessageContext</span><span class="p">,</span> <span class="n">InteractionContext</span><span class="p">,</span> <span class="n">ComponentContext</span><span class="p">,</span> <span class="n">AutocompleteContext</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return a context object based on data passed</span>

<span class="sd">    note:</span>
<span class="sd">        If you want to use custom context objects, this is the method to override. Your replacement must take the same arguments as this, and return a Context-like object.</span>

<span class="sd">    Args:</span>
<span class="sd">        data: The data of the event</span>
<span class="sd">        interaction: Is this an interaction or not?</span>

<span class="sd">    returns:</span>
<span class="sd">        Context object</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># this line shuts up IDE warnings</span>
    <span class="bp">cls</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">MessageContext</span><span class="p">,</span> <span class="n">ComponentContext</span><span class="p">,</span> <span class="n">InteractionContext</span><span class="p">,</span> <span class="n">AutocompleteContext</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">interaction</span><span class="p">:</span>
        <span class="c1"># todo: change to match</span>
        <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">InteractionTypes</span><span class="o">.</span><span class="n">MESSAGE_COMPONENT</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ComponentContext</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">InteractionTypes</span><span class="o">.</span><span class="n">AUTOCOMPLETE</span><span class="p">:</span>
            <span class="bp">cls</span> <span class="o">=</span> <span class="n">AutocompleteContext</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">cls</span> <span class="o">=</span> <span class="n">InteractionContext</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

        <span class="n">invoked_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">if</span> <span class="n">options</span> <span class="o">:=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;options&quot;</span><span class="p">):</span>
            <span class="n">o_type</span> <span class="o">=</span> <span class="n">options</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;type&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">o_type</span> <span class="ow">in</span> <span class="p">(</span><span class="n">OptionTypes</span><span class="o">.</span><span class="n">SUB_COMMAND</span><span class="p">,</span> <span class="n">OptionTypes</span><span class="o">.</span><span class="n">SUB_COMMAND_GROUP</span><span class="p">):</span>
                <span class="c1"># this is a subcommand, process accordingly</span>
                <span class="k">if</span> <span class="n">o_type</span> <span class="o">==</span> <span class="n">OptionTypes</span><span class="o">.</span><span class="n">SUB_COMMAND</span><span class="p">:</span>
                    <span class="n">invoked_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">invoked_name</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">options</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="n">options</span> <span class="o">=</span> <span class="n">options</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;options&quot;</span><span class="p">,</span> <span class="p">[])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">invoked_name</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">invoked_name</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">options</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">next</span><span class="p">(</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">options</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;options&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">OptionTypes</span><span class="o">.</span><span class="n">SUB_COMMAND</span><span class="p">)[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="p">)</span>
                    <span class="n">options</span> <span class="o">=</span> <span class="n">options</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;options&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;options&quot;</span><span class="p">,</span> <span class="p">[])</span>

            <span class="k">for</span> <span class="n">option</span> <span class="ow">in</span> <span class="n">options</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">option</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">)</span>

                <span class="c1"># todo change to match statement</span>
                <span class="c1"># this block here resolves the options using the cache</span>
                <span class="k">if</span> <span class="n">option</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">OptionTypes</span><span class="o">.</span><span class="n">USER</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">member_cache</span><span class="o">.</span><span class="n">get</span><span class="p">((</span><span class="n">to_snowflake</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;guild_id&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span> <span class="n">to_snowflake</span><span class="p">(</span><span class="n">value</span><span class="p">)))</span>
                        <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">user_cache</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">to_snowflake</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
                    <span class="p">)</span> <span class="ow">or</span> <span class="n">value</span>
                <span class="k">elif</span> <span class="n">option</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">OptionTypes</span><span class="o">.</span><span class="n">CHANNEL</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">channel_cache</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">to_snowflake</span><span class="p">(</span><span class="n">value</span><span class="p">))</span> <span class="ow">or</span> <span class="n">value</span>
                <span class="k">elif</span> <span class="n">option</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">OptionTypes</span><span class="o">.</span><span class="n">ROLE</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">role_cache</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">to_snowflake</span><span class="p">(</span><span class="n">value</span><span class="p">))</span> <span class="ow">or</span> <span class="n">value</span>
                <span class="k">elif</span> <span class="n">option</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">OptionTypes</span><span class="o">.</span><span class="n">MENTIONABLE</span><span class="p">:</span>
                    <span class="n">snow</span> <span class="o">=</span> <span class="n">to_snowflake</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">user</span> <span class="o">:=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">member_cache</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">snow</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">user_cache</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">snow</span><span class="p">):</span>
                        <span class="n">value</span> <span class="o">=</span> <span class="n">user</span>
                    <span class="k">elif</span> <span class="n">role</span> <span class="o">:=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">role_cache</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">snow</span><span class="p">):</span>
                        <span class="n">value</span> <span class="o">=</span> <span class="n">role</span>
                <span class="k">if</span> <span class="n">option</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;focused&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
                    <span class="bp">cls</span><span class="o">.</span><span class="n">focussed_option</span> <span class="o">=</span> <span class="n">option</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="n">option</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span> <span class="o">=</span> <span class="n">value</span>

        <span class="bp">cls</span><span class="o">.</span><span class="n">invoked_name</span> <span class="o">=</span> <span class="n">invoked_name</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">kwargs</span> <span class="o">=</span> <span class="n">kwargs</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">values</span><span class="p">()]</span>

        <span class="k">return</span> <span class="bp">cls</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">MessageContext</span><span class="o">.</span><span class="n">from_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>





  <div class="doc doc-object doc-method">



<h3 id="dis_snek.client.Snake.get_scale" class="doc doc-heading">


<code class="highlight language-python"><span class="n">get_scale</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span></code>
<a href="#dis_snek.client.Snake.get_scale" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Get a scale</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>name</code></td>
        <td></td>
        <td><p>The name of the scale, or the name of it's extension</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>Optional[dis_snek.models.scale.Scale]</code></td>
      <td><p>Scale or None if no scale is found</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>dis_snek/client.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">get_scale</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Scale</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get a scale</span>
<span class="sd">    Args:</span>
<span class="sd">        name: The name of the scale, or the name of it&#39;s extension</span>

<span class="sd">    Returns:</span>
<span class="sd">        Scale or None if no scale is found</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">scales</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">scale</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">scales</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">scale</span><span class="o">.</span><span class="n">extension_name</span> <span class="o">==</span> <span class="n">name</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">scale</span>

    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">scales</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>





  <div class="doc doc-object doc-method">



<h3 id="dis_snek.client.Snake.grow_scale" class="doc doc-heading">


<code class="highlight language-python"><span class="n">grow_scale</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">package</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>
<a href="#dis_snek.client.Snake.grow_scale" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>A helper method to load a scale</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>file_name</code></td>
        <td><code>str</code></td>
        <td><p>The name of the file to load the scale from.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>package</code></td>
        <td><code>str</code></td>
        <td><p>The package this scale is in.</p></td>
        <td><code>None</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>dis_snek/client.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">grow_scale</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">package</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A helper method to load a scale</span>

<span class="sd">    Args:</span>
<span class="sd">        file_name: The name of the file to load the scale from.</span>
<span class="sd">        package: The package this scale is in.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">load_extension</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">package</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>





  <div class="doc doc-object doc-method">



<h3 id="dis_snek.client.Snake.shed_scale" class="doc doc-heading">


<code class="highlight language-python"><span class="n">shed_scale</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scale_name</span><span class="p">)</span></code>
<a href="#dis_snek.client.Snake.shed_scale" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Helper method to unload a scale</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>scale_name</code></td>
        <td><code>str</code></td>
        <td><p>The name of the scale to unload.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>dis_snek/client.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">shed_scale</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scale_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Helper method to unload a scale</span>

<span class="sd">    Args:</span>
<span class="sd">        scale_name: The name of the scale to unload.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">scale</span> <span class="o">:=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_scale</span><span class="p">(</span><span class="n">scale_name</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">unload_extension</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">getmodule</span><span class="p">(</span><span class="n">scale</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>

    <span class="k">raise</span> <span class="n">ScaleLoadException</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unable to shed scale: No scale exists with name: `</span><span class="si">{</span><span class="n">scale_name</span><span class="si">}</span><span class="s2">`&quot;</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>





  <div class="doc doc-object doc-method">



<h3 id="dis_snek.client.Snake.regrow_scale" class="doc doc-heading">


<code class="highlight language-python"><span class="n">regrow_scale</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scale_name</span><span class="p">)</span></code>
<a href="#dis_snek.client.Snake.regrow_scale" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Helper method to reload a scale.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>scale_name</code></td>
        <td><code>str</code></td>
        <td><p>The name of the scale to reload</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>dis_snek/client.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">regrow_scale</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scale_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Helper method to reload a scale.</span>

<span class="sd">    Args:</span>
<span class="sd">        scale_name: The name of the scale to reload</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">shed_scale</span><span class="p">(</span><span class="n">scale_name</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">grow_scale</span><span class="p">(</span><span class="n">scale_name</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>





  <div class="doc doc-object doc-method">



<h3 id="dis_snek.client.Snake.load_extension" class="doc doc-heading">


<code class="highlight language-python"><span class="n">load_extension</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">package</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>
<a href="#dis_snek.client.Snake.load_extension" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Load an extension.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>name</code></td>
        <td><code>str</code></td>
        <td><p>The name of the extension.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>package</code></td>
        <td><code>str</code></td>
        <td><p>The package the extension is in</p></td>
        <td><code>None</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>dis_snek/client.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">load_extension</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">package</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Load an extension.</span>

<span class="sd">    Args:</span>
<span class="sd">        name: The name of the extension.</span>
<span class="sd">        package: The package the extension is in</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">importlib</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">resolve_name</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">package</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__extensions</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> already loaded&quot;</span><span class="p">)</span>

    <span class="n">module</span> <span class="o">=</span> <span class="n">importlib</span><span class="o">.</span><span class="n">import_module</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">package</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">setup</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="s2">&quot;setup&quot;</span><span class="p">)</span>
        <span class="n">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">del</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
        <span class="k">raise</span> <span class="n">ExtensionLoadException</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error loading </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">e</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Loaded Extension: </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__extensions</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">module</span>
        <span class="k">return</span>
</code></pre></div>
        </details>
    </div>

  </div>





  <div class="doc doc-object doc-method">



<h3 id="dis_snek.client.Snake.unload_extension" class="doc doc-heading">


<code class="highlight language-python"><span class="n">unload_extension</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">package</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>
<a href="#dis_snek.client.Snake.unload_extension" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>unload an extension.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>name</code></td>
        <td></td>
        <td><p>The name of the extension.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>package</code></td>
        <td></td>
        <td><p>The package the extension is in</p></td>
        <td><code>None</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>dis_snek/client.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">unload_extension</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">package</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    unload an extension.</span>

<span class="sd">    Args:</span>
<span class="sd">        name: The name of the extension.</span>
<span class="sd">        package: The package the extension is in</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">importlib</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">resolve_name</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">package</span><span class="p">)</span>
    <span class="n">module</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__extensions</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">module</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ExtensionNotFound</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No extension called </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> is loaded&quot;</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">teardown</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="s2">&quot;teardown&quot;</span><span class="p">)</span>
        <span class="n">teardown</span><span class="p">()</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="k">if</span> <span class="n">scale</span> <span class="o">:=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_scale</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
        <span class="n">scale</span><span class="o">.</span><span class="n">shed</span><span class="p">()</span>

    <span class="k">del</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
    <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">__extensions</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
</code></pre></div>
        </details>
    </div>

  </div>





  <div class="doc doc-object doc-method">



<h3 id="dis_snek.client.Snake.reload_extension" class="doc doc-heading">


<code class="highlight language-python"><span class="n">reload_extension</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">package</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>
<a href="#dis_snek.client.Snake.reload_extension" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Helper method to reload an extension.
Simply unloads, then loads the extension.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>name</code></td>
        <td></td>
        <td><p>The name of the extension.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>package</code></td>
        <td></td>
        <td><p>The package the extension is in</p></td>
        <td><code>None</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>dis_snek/client.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">reload_extension</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">package</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Helper method to reload an extension.</span>
<span class="sd">    Simply unloads, then loads the extension.</span>

<span class="sd">    Args:</span>
<span class="sd">        name: The name of the extension.</span>
<span class="sd">        package: The package the extension is in</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">importlib</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">resolve_name</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">package</span><span class="p">)</span>
    <span class="n">module</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__extensions</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">module</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Attempted to reload extension thats not loaded. Loading extension instead&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_extension</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">package</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">unload_extension</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">package</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">load_extension</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">package</span><span class="p">)</span>

    <span class="c1"># todo: maybe add an ability to revert to the previous version if unable to load the new one</span>
</code></pre></div>
        </details>
    </div>

  </div>





  <div class="doc doc-object doc-method">



<h3 id="dis_snek.client.Snake.get_guild" class="doc doc-heading">

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-async"><code>async</code></small>
  </span>

<code class="highlight language-python"><span class="n">get_guild</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">guild_id</span><span class="p">)</span></code>
<a href="#dis_snek.client.Snake.get_guild" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Get a guild</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This method is an alias for the cache which will either return a cached object, or query discord for the object
if its not already cached.</p>
</div>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>guild_id</code></td>
        <td><code>Snowflake_Type</code></td>
        <td><p>The ID of the guild to get</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>Guild</code></td>
      <td><p>Guild Object</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>dis_snek/client.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">async</span> <span class="k">def</span> <span class="nf">get_guild</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">guild_id</span><span class="p">:</span> <span class="s2">&quot;Snowflake_Type&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Guild</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get a guild</span>

<span class="sd">    Note:</span>
<span class="sd">        This method is an alias for the cache which will either return a cached object, or query discord for the object</span>
<span class="sd">        if its not already cached.</span>

<span class="sd">    Args:</span>
<span class="sd">        guild_id: The ID of the guild to get</span>

<span class="sd">    Returns:</span>
<span class="sd">        Guild Object</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">get_guild</span><span class="p">(</span><span class="n">guild_id</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>





  <div class="doc doc-object doc-method">



<h3 id="dis_snek.client.Snake.get_channel" class="doc doc-heading">

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-async"><code>async</code></small>
  </span>

<code class="highlight language-python"><span class="n">get_channel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel_id</span><span class="p">)</span></code>
<a href="#dis_snek.client.Snake.get_channel" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Get a channel</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This method is an alias for the cache which will either return a cached object, or query discord for the object
if its not already cached.</p>
</div>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>channel_id</code></td>
        <td><code>Snowflake_Type</code></td>
        <td><p>The ID of the channel to get</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>TYPE_ALL_CHANNEL</code></td>
      <td><p>Channel Object</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>dis_snek/client.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">async</span> <span class="k">def</span> <span class="nf">get_channel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel_id</span><span class="p">:</span> <span class="s2">&quot;Snowflake_Type&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;TYPE_ALL_CHANNEL&quot;</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get a channel</span>

<span class="sd">    Note:</span>
<span class="sd">        This method is an alias for the cache which will either return a cached object, or query discord for the object</span>
<span class="sd">        if its not already cached.</span>

<span class="sd">    Args:</span>
<span class="sd">        channel_id: The ID of the channel to get</span>

<span class="sd">    Returns:</span>
<span class="sd">        Channel Object</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">get_channel</span><span class="p">(</span><span class="n">channel_id</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>





  <div class="doc doc-object doc-method">



<h3 id="dis_snek.client.Snake.get_user" class="doc doc-heading">

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-async"><code>async</code></small>
  </span>

<code class="highlight language-python"><span class="n">get_user</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_id</span><span class="p">)</span></code>
<a href="#dis_snek.client.Snake.get_user" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Get a user</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This method is an alias for the cache which will either return a cached object, or query discord for the object
if its not already cached.</p>
</div>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>user_id</code></td>
        <td><code>Snowflake_Type</code></td>
        <td><p>The ID of the user to get</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>User</code></td>
      <td><p>User Object</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>dis_snek/client.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">async</span> <span class="k">def</span> <span class="nf">get_user</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_id</span><span class="p">:</span> <span class="s2">&quot;Snowflake_Type&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">User</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get a user</span>

<span class="sd">    Note:</span>
<span class="sd">        This method is an alias for the cache which will either return a cached object, or query discord for the object</span>
<span class="sd">        if its not already cached.</span>

<span class="sd">    Args:</span>
<span class="sd">        user_id: The ID of the user to get</span>

<span class="sd">    Returns:</span>
<span class="sd">        User Object</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">get_user</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>





  <div class="doc doc-object doc-method">



<h3 id="dis_snek.client.Snake.get_member" class="doc doc-heading">

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-async"><code>async</code></small>
  </span>

<code class="highlight language-python"><span class="n">get_member</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">guild_id</span><span class="p">)</span></code>
<a href="#dis_snek.client.Snake.get_member" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Get a member from a guild</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This method is an alias for the cache which will either return a cached object, or query discord for the object
if its not already cached.</p>
</div>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>user_id</code></td>
        <td><code>Snowflake_Type</code></td>
        <td><p>The ID of the member</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>guild_id</code></td>
        <td><code>Snowflake_Type</code></td>
        <td><p>The ID of the guild to get the member from</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>Member</code></td>
      <td><p>Member object</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>dis_snek/client.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">async</span> <span class="k">def</span> <span class="nf">get_member</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_id</span><span class="p">:</span> <span class="s2">&quot;Snowflake_Type&quot;</span><span class="p">,</span> <span class="n">guild_id</span><span class="p">:</span> <span class="s2">&quot;Snowflake_Type&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Member</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get a member from a guild</span>

<span class="sd">    Note:</span>
<span class="sd">        This method is an alias for the cache which will either return a cached object, or query discord for the object</span>
<span class="sd">        if its not already cached.</span>

<span class="sd">    Args:</span>
<span class="sd">        user_id: The ID of the member</span>
<span class="sd">        guild_id: The ID of the guild to get the member from</span>

<span class="sd">    Returns:</span>
<span class="sd">        Member object</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">get_member</span><span class="p">(</span><span class="n">guild_id</span><span class="p">,</span> <span class="n">user_id</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>











  <div class="doc doc-object doc-method">



<h3 id="dis_snek.client.Snake.change_presence" class="doc doc-heading">

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-async"><code>async</code></small>
  </span>

<code class="highlight language-python"><span class="n">change_presence</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">status</span><span class="o">=&lt;</span><span class="n">Status</span><span class="o">.</span><span class="n">ONLINE</span><span class="p">:</span> <span class="s1">&#39;online&#39;</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">activity</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>
<a href="#dis_snek.client.Snake.change_presence" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Change the bots presence.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>status</code></td>
        <td><code>Union[str, dis_snek.models.enums.Status]</code></td>
        <td><p>The status for the bot to be. i.e. online, afk, etc.</p></td>
        <td><code>&lt;Status.ONLINE: &#39;online&#39;&gt;</code></td>
      </tr>
      <tr>
        <td><code>activity</code></td>
        <td><code>Union[dis_snek.models.discord_objects.activity.Activity, str]</code></td>
        <td><p>The activity for the bot to be displayed as doing.</p></td>
        <td><code>None</code></td>
      </tr>
  </tbody>
</table>      <p>note::
    Bots may only be <code>playing</code> <code>streaming</code> or <code>listening</code>, other activity types are likely to fail.</p>

        <details class="quote">
          <summary>Source code in <code>dis_snek/client.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">async</span> <span class="k">def</span> <span class="nf">change_presence</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">status</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Status</span><span class="p">]]</span> <span class="o">=</span> <span class="n">Status</span><span class="o">.</span><span class="n">ONLINE</span><span class="p">,</span> <span class="n">activity</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">Activity</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Change the bots presence.</span>

<span class="sd">    Args:</span>
<span class="sd">        status: The status for the bot to be. i.e. online, afk, etc.</span>
<span class="sd">        activity: The activity for the bot to be displayed as doing.</span>

<span class="sd">    note::</span>
<span class="sd">        Bots may only be `playing` `streaming` or `listening`, other activity types are likely to fail.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">activity</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">activity</span><span class="p">,</span> <span class="n">Activity</span><span class="p">):</span>
            <span class="c1"># squash whatever the user passed into an activity</span>
            <span class="n">activity</span> <span class="o">=</span> <span class="n">Activity</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">activity</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">activity</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">ActivityType</span><span class="o">.</span><span class="n">STREAMING</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">activity</span><span class="o">.</span><span class="n">url</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Streaming activity cannot be set without a valid URL attribute&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">activity</span><span class="o">.</span><span class="n">type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="n">ActivityType</span><span class="o">.</span><span class="n">GAME</span><span class="p">,</span> <span class="n">ActivityType</span><span class="o">.</span><span class="n">STREAMING</span><span class="p">,</span> <span class="n">ActivityType</span><span class="o">.</span><span class="n">LISTENING</span><span class="p">]:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Activity type `</span><span class="si">{</span><span class="n">ActivityType</span><span class="p">(</span><span class="n">activity</span><span class="o">.</span><span class="n">type</span><span class="p">)</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">` may not be enabled for bots&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">activity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_activity</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_activity</span> <span class="k">else</span> <span class="p">[]</span>

    <span class="k">if</span> <span class="n">status</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">status</span><span class="p">,</span> <span class="n">Status</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">status</span> <span class="o">=</span> <span class="n">Status</span><span class="p">[</span><span class="n">status</span><span class="o">.</span><span class="n">upper</span><span class="p">()]</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;`</span><span class="si">{</span><span class="n">status</span><span class="si">}</span><span class="s2">` is not a valid status type. Please use the Status enum&quot;</span><span class="p">)</span> <span class="kn">from</span> <span class="bp">None</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># in case the user set status to None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_status</span><span class="p">:</span>
            <span class="n">status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_status</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Status must be set to a valid status type, defaulting to online&quot;</span><span class="p">)</span>
            <span class="n">status</span> <span class="o">=</span> <span class="n">Status</span><span class="o">.</span><span class="n">ONLINE</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_status</span> <span class="o">=</span> <span class="n">status</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_activity</span> <span class="o">=</span> <span class="n">activity</span>
    <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">ws</span><span class="o">.</span><span class="n">change_presence</span><span class="p">(</span><span class="n">activity</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span> <span class="k">if</span> <span class="n">activity</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span> <span class="n">status</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>





  </div>

    </div>

  </div>
                
              
              
                


              
            </article>
          </div>
        </div>
        
          <a href="#" class="md-top md-icon" data-md-component="top" data-md-state="hidden">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"/></svg>
            Back to top
          </a>
        
      </main>
      
        <!--
  Copyright (c) 2016-2021 Martin Donath <martin.donath@squidfunk.com>

  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:

  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
-->



<!-- Footer -->
<footer class="md-footer">


  <!-- Further information -->
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">

      <!-- Copyright and theme information -->
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2021 - 2021 LordOfPolls
          </div>
        
        
          Made with
          <a
            href="https://squidfunk.github.io/mkdocs-material/"
            target="_blank" rel="noopener"
          >
            Material for MkDocs
          </a>
        
        
      </div>

      <!-- Social links -->
      
  <div class="md-footer-social">
    
      
      
      <a href="https://discord.gg/WCtUY2CRVu" target="_blank" rel="noopener" title="Discord Server" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path d="M524.531 69.836a1.5 1.5 0 0 0-.764-.7A485.065 485.065 0 0 0 404.081 32.03a1.816 1.816 0 0 0-1.923.91 337.461 337.461 0 0 0-14.9 30.6 447.848 447.848 0 0 0-134.426 0 309.541 309.541 0 0 0-15.135-30.6 1.89 1.89 0 0 0-1.924-.91 483.689 483.689 0 0 0-119.688 37.107 1.712 1.712 0 0 0-.788.676C39.068 183.651 18.186 294.69 28.43 404.354a2.016 2.016 0 0 0 .765 1.375 487.666 487.666 0 0 0 146.825 74.189 1.9 1.9 0 0 0 2.063-.676A348.2 348.2 0 0 0 208.12 430.4a1.86 1.86 0 0 0-1.019-2.588 321.173 321.173 0 0 1-45.868-21.853 1.885 1.885 0 0 1-.185-3.126 251.047 251.047 0 0 0 9.109-7.137 1.819 1.819 0 0 1 1.9-.256c96.229 43.917 200.41 43.917 295.5 0a1.812 1.812 0 0 1 1.924.233 234.533 234.533 0 0 0 9.132 7.16 1.884 1.884 0 0 1-.162 3.126 301.407 301.407 0 0 1-45.89 21.83 1.875 1.875 0 0 0-1 2.611 391.055 391.055 0 0 0 30.014 48.815 1.864 1.864 0 0 0 2.063.7A486.048 486.048 0 0 0 610.7 405.729a1.882 1.882 0 0 0 .765-1.352c12.264-126.783-20.532-236.912-86.934-334.541zM222.491 337.58c-28.972 0-52.844-26.587-52.844-59.239s23.409-59.241 52.844-59.241c29.665 0 53.306 26.82 52.843 59.239 0 32.654-23.41 59.241-52.843 59.241zm195.38 0c-28.971 0-52.843-26.587-52.843-59.239s23.409-59.241 52.843-59.241c29.667 0 53.307 26.82 52.844 59.239 0 32.654-23.177 59.241-52.844 59.241z"/></svg>
      </a>
    
      
      
      <a href="https://github.com/Discord-Snake-Pit/Dis-Snek" target="_blank" rel="noopener" title="Github Repository" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
      </a>
    
      
      
      <a href="https://trello.com/b/LVjnmYKt/dev-board" target="_blank" rel="noopener" title="Trello Board" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M392.3 32H56.1C25.1 32 0 57.1 0 88c-.1 0 0-4 0 336 0 30.9 25.1 56 56 56h336.2c30.8-.2 55.7-25.2 55.7-56V88c.1-30.8-24.8-55.8-55.6-56zM197 371.3c-.2 14.7-12.1 26.6-26.9 26.6H87.4c-14.8.1-26.9-11.8-27-26.6V117.1c0-14.8 12-26.9 26.9-26.9h82.9c14.8 0 26.9 12 26.9 26.9v254.2zm193.1-112c0 14.8-12 26.9-26.9 26.9h-81c-14.8 0-26.9-12-26.9-26.9V117.2c0-14.8 12-26.9 26.8-26.9h81.1c14.8 0 26.9 12 26.9 26.9v142.1z"/></svg>
      </a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../..", "features": ["header.autohide", "navigation.instant", "navigation.top", "navigation.tabs", "search.suggest", "search.share"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../../assets/javascripts/workers/search.fcfe8b6d.min.js", "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.b1047164.min.js"></script>
      
    
  </body>
</html>